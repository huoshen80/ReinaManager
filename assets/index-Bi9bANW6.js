import{g as _,a as G,r as u,u as D,L as q,j as e,s as E,c as F,b as W,m as O,d as B,k as X,e as N,f as Y,h as J,i as Q,l as S,n as $,o as T,E as Z,B as r,T as x,p as A,q as k,R as M,t as R,A as L,v as C,D as z,w as V,x as ee}from"./index-8LpMZBdz.js";import{S as te,A as se,T as ae}from"./Today-BSVEVOiX.js";import{C as w}from"./Card-CcP84HZ5.js";import{C as I}from"./CardContent-BVd1vCqa.js";function ie(s){return String(s).match(/[\d.\-+]*\s*(.*)/)[1]||""}function ne(s){return parseFloat(s)}function oe(s){return _("MuiListItemAvatar",s)}G("MuiListItemAvatar",["root","alignItemsFlexStart"]);const le=s=>{const{alignItems:n,classes:i}=s;return W({root:["root",n==="flex-start"&&"alignItemsFlexStart"]},oe,i)},re=E("div",{name:"MuiListItemAvatar",slot:"Root",overridesResolver:(s,n)=>{const{ownerState:i}=s;return[n.root,i.alignItems==="flex-start"&&n.alignItemsFlexStart]}})({minWidth:56,flexShrink:0,variants:[{props:{alignItems:"flex-start"},style:{marginTop:8}}]}),H=u.forwardRef(function(n,i){const l=D({props:n,name:"MuiListItemAvatar"}),{className:h,...v}=l,c=u.useContext(q),p={...l,alignItems:c.alignItems},o=le(p);return e.jsx(re,{className:F(o.root,h),ownerState:p,ref:i,...v})});function ce(s){return _("MuiSkeleton",s)}G("MuiSkeleton",["root","text","rectangular","rounded","circular","pulse","wave","withChildren","fitContent","heightAuto"]);const de=s=>{const{classes:n,variant:i,animation:l,hasChildren:h,width:v,height:c}=s;return W({root:["root",i,l,h&&"withChildren",h&&!v&&"fitContent",h&&!c&&"heightAuto"]},ce,n)},P=X`
  0% {
    opacity: 1;
  }

  50% {
    opacity: 0.4;
  }

  100% {
    opacity: 1;
  }
`,U=X`
  0% {
    transform: translateX(-100%);
  }

  50% {
    /* +0.5s of delay between each loop */
    transform: translateX(100%);
  }

  100% {
    transform: translateX(100%);
  }
`,me=typeof P!="string"?B`
        animation: ${P} 2s ease-in-out 0.5s infinite;
      `:null,he=typeof U!="string"?B`
        &::after {
          animation: ${U} 2s linear 0.5s infinite;
        }
      `:null,pe=E("span",{name:"MuiSkeleton",slot:"Root",overridesResolver:(s,n)=>{const{ownerState:i}=s;return[n.root,n[i.variant],i.animation!==!1&&n[i.animation],i.hasChildren&&n.withChildren,i.hasChildren&&!i.width&&n.fitContent,i.hasChildren&&!i.height&&n.heightAuto]}})(O(({theme:s})=>{const n=ie(s.shape.borderRadius)||"px",i=ne(s.shape.borderRadius);return{display:"block",backgroundColor:s.vars?s.vars.palette.Skeleton.bg:s.alpha(s.palette.text.primary,s.palette.mode==="light"?.11:.13),height:"1.2em",variants:[{props:{variant:"text"},style:{marginTop:0,marginBottom:0,height:"auto",transformOrigin:"0 55%",transform:"scale(1, 0.60)",borderRadius:`${i}${n}/${Math.round(i/.6*10)/10}${n}`,"&:empty:before":{content:'"\\00a0"'}}},{props:{variant:"circular"},style:{borderRadius:"50%"}},{props:{variant:"rounded"},style:{borderRadius:(s.vars||s).shape.borderRadius}},{props:({ownerState:l})=>l.hasChildren,style:{"& > *":{visibility:"hidden"}}},{props:({ownerState:l})=>l.hasChildren&&!l.width,style:{maxWidth:"fit-content"}},{props:({ownerState:l})=>l.hasChildren&&!l.height,style:{height:"auto"}},{props:{animation:"pulse"},style:me||{animation:`${P} 2s ease-in-out 0.5s infinite`}},{props:{animation:"wave"},style:{position:"relative",overflow:"hidden",WebkitMaskImage:"-webkit-radial-gradient(white, black)","&::after":{background:`linear-gradient(
                90deg,
                transparent,
                ${(s.vars||s).palette.action.hover},
                transparent
              )`,content:'""',position:"absolute",transform:"translateX(-100%)",bottom:0,left:0,right:0,top:0}}},{props:{animation:"wave"},style:he||{"&::after":{animation:`${U} 2s linear 0.5s infinite`}}}]}})),g=u.forwardRef(function(n,i){const l=D({props:n,name:"MuiSkeleton"}),{animation:h="pulse",className:v,component:c="span",height:p,style:o,variant:j="text",width:a,...m}=l,f={...l,animation:h,component:c,variant:j,hasChildren:!!m.children},y=de(f);return e.jsx(pe,{as:c,ref:i,className:F(y.root,v),ownerState:f,...m,style:{width:a,height:p,...o}})}),xe=N(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m5 11h-4v4h-2v-4H7v-2h4V7h2v4h4z"})),ue=N(e.jsx("path",{d:"M9 11H7v2h2zm4 0h-2v2h2zm4 0h-2v2h2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 16H5V9h14z"})),ve=N(e.jsx("path",{d:"M15 7.5V2H9v5.5l3 3zM7.5 9H2v6h5.5l3-3zM9 16.5V22h6v-5.5l-3-3zM16.5 9l-3 3 3 3H22V9z"})),fe=N(e.jsx("path",{d:"M20 2H4c-1 0-2 .9-2 2v3.01c0 .72.43 1.34 1 1.69V20c0 1.1 1.1 2 2 2h14c.9 0 2-.9 2-2V8.7c.57-.35 1-.97 1-1.69V4c0-1.1-1-2-2-2m-5 12H9v-2h6zm5-7H4V4l16-.02z"})),ge=N(e.jsx("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2m6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1z"})),ye=N(e.jsx("path",{d:"M2 20h20v-4H2zm2-3h2v2H4zM2 4v4h20V4zm4 3H4V5h2zm-4 7h20v-4H2zm2-3h2v2H4z"}));async function je(s,n){const i=[],l=[],h=s.filter(a=>a.id&&typeof a.id=="number").map(a=>a.id),v=await ee(h,10);for(const a of s){if(!a.id||typeof a.id!="number")continue;const m=v.get(a.id)||[],f=$(a,n),y=S(a);for(const t of m.filter(d=>typeof d.end_time=="number")){const d={id:`play-${t.session_id||a.id}-${t.end_time}`,type:"play",gameId:a.id,gameTitle:f,imageUrl:y,time:t.end_time,duration:t.duration};i.push(d),l.push({session_id:t.session_id,game_id:a.id,end_time:t.end_time,gameTitle:f,imageUrl:y})}}const c=[],p=[],o=s.filter(a=>typeof a.id=="number"&&a.created_at);for(const a of o){const m=a.created_at,f=new Date(m*1e3),y=$(a,n),t={id:`add-${a.id}`,type:"add",gameId:a.id,gameTitle:y,imageUrl:S(a),time:m};c.push(t),p.push({id:a.id,title:y,imageUrl:S(a),time:f})}const j=[...i,...c].sort((a,m)=>m.time-a.time);return l.sort((a,m)=>m.end_time-a.end_time),p.sort((a,m)=>a.time&&m.time?m.time.getTime()-a.time.getTime():0),{sessions:l.slice(0,6),added:p.slice(0,6),activities:j.slice(0,10)}}const Ie=()=>{const{allGames:s}=Y(),{getTotalPlayTime:n,getWeekPlayTime:i,getTodayPlayTime:l}=J(),[h,v]=u.useState({total:0,week:0,today:0,loading:!0}),[c,p]=u.useState({sessions:[],added:[],activities:[],loading:!0}),{t:o,i18n:j}=Q(),a=u.useMemo(()=>s.map(t=>({title:$(t,j.language),id:t.id,isLocal:t.localpath!=="",imageUrl:S(t)})),[s,j.language]),m=u.useMemo(()=>a.filter(t=>t.isLocal).length,[a]),f=u.useMemo(()=>s.filter(t=>t.clear===1).length,[s]),y=u.useMemo(()=>[{title:o("home.stats.totalGames","总游戏数"),value:s.length,icon:e.jsx(te,{}),isAsync:!1},{title:o("home.stats.localGames","本地游戏数"),value:m,icon:e.jsx(ye,{}),isAsync:!1},{title:o("home.stats.completedGames","通关游戏数"),value:f,icon:e.jsx(Z,{}),isAsync:!1},{title:o("home.stats.totalPlayTime","总游戏时长"),value:T(h.total),icon:e.jsx(se,{}),isAsync:!0},{title:o("home.stats.weekPlayTime","本周游戏时长"),value:T(h.week),icon:e.jsx(ue,{}),isAsync:!0},{title:o("home.stats.todayPlayTime","今日游戏时长"),value:T(h.today),icon:e.jsx(ae,{}),isAsync:!0}],[o,s.length,m,f,h]);return u.useEffect(()=>{(async()=>{try{const[d,b,K]=await Promise.all([n(),i(),l()]);v({total:d,week:b,today:K,loading:!1})}catch(d){console.error("获取游戏时长统计失败:",d),v(b=>({...b,loading:!1}))}})()},[n,i,l]),u.useEffect(()=>{(async()=>{try{const d=await je(s,j.language);p({sessions:d.sessions,added:d.added,activities:d.activities,loading:!1})}catch(d){console.error("获取首页活动数据失败:",d),p(b=>({...b,loading:!1}))}})()},[s,j.language]),e.jsxs(r,{className:"p-6 flex flex-col gap-4",children:[e.jsx(x,{variant:"h4",className:"font-bold ",children:o("home.title","主页")}),e.jsx(r,{className:"grid grid-cols-12 gap-6",children:y.map(t=>e.jsx(r,{className:"col-span-12 sm:col-span-6 md:col-span-4 lg:col-span-2",children:e.jsx(w,{className:"h-full shadow-md hover:shadow-lg transition-shadow",children:e.jsxs(I,{className:"flex flex-col items-center text-center",children:[t.icon,e.jsx(x,{title:String(t.value),variant:"h6",className:"font-bold mb-1 w-full whitespace-nowrap overflow-hidden text-ellipsis",children:t.isAsync&&h.loading?e.jsx(g,{width:60}):t.value}),e.jsx(x,{variant:"body2",color:"text.secondary",children:t.title})]})})},t.title))}),e.jsxs(r,{className:"grid grid-cols-12 gap-6",children:[e.jsx(r,{className:"col-span-12 md:col-span-6 lg:col-span-3",children:e.jsx(w,{className:"h-full shadow-md",children:e.jsxs(I,{children:[e.jsxs(r,{component:A,to:"/libraries",className:"flex items-center mb-3 text-inherit decoration-none hover:scale-105 hover:shadow-lg cursor-pointer",children:[e.jsx(fe,{className:"mr-2 text-amber-500"}),e.jsx(x,{variant:"h6",className:"font-bold",children:o("home.repository","游戏仓库")})]}),e.jsx(r,{className:"grid grid-cols-1 gap-2 max-h-44vh overflow-y-auto pr-1",children:a.map(t=>e.jsx(w,{variant:"outlined",component:A,to:`/libraries/${t.id}`,sx:{p:1,textAlign:"center",cursor:"pointer",textDecoration:"none","&:hover":{transform:"translateY(-2px)",boxShadow:2}},children:e.jsx(x,{variant:"body2",children:t.title})},t.id))})]})})}),e.jsx(r,{className:"col-span-12 md:col-span-6 lg:col-span-3",children:e.jsx(w,{className:"h-full shadow-md",children:e.jsxs(I,{children:[e.jsxs(r,{className:"flex items-center mb-3",children:[e.jsx(ge,{className:"mr-2 text-purple-500"}),e.jsx(x,{variant:"h6",className:"font-bold",children:o("home.activityTitle","动态")})]}),c.loading?e.jsx(r,{className:"max-h-44vh overflow-y-auto pr-1",children:[1,2,3,4].map(t=>e.jsxs(r,{className:"flex items-center mb-3",children:[e.jsx(g,{variant:"rounded",width:40,height:40,className:"mr-3"}),e.jsxs(r,{className:"flex-1",children:[e.jsx(g,{width:"80%",height:20}),e.jsx(g,{width:"60%",height:16})]})]},t))}):e.jsx(k,{className:"max-h-44vh overflow-y-auto pr-1",children:c.activities.map((t,d)=>e.jsxs(M.Fragment,{children:[e.jsxs(R,{className:"px-0 text-inherit",component:A,to:`/libraries/${t.gameId}`,children:[e.jsx(H,{children:e.jsx(L,{variant:"rounded",src:t.imageUrl})}),e.jsxs(r,{children:[e.jsx(x,{variant:"body1",children:t.type==="add"?o("home.activity.added",{title:t.gameTitle}):o("home.activity.played",{title:t.gameTitle})}),e.jsx(x,{variant:"body2",color:"text.secondary",children:t.type==="add"?o("home.activity.addedAt",{time:C(t.time)}):o("home.activity.playedAtTime",{time:C(t.time)})}),t.type==="play"&&t.duration!==void 0&&e.jsx(x,{variant:"body2",color:"text.secondary",children:o("home.activity.duration",{duration:T(t.duration)})})]})]}),d!==c.activities.length-1&&e.jsx(z,{})]},t.id))})]})})}),e.jsx(r,{className:"col-span-12 md:col-span-6 lg:col-span-3",children:e.jsx(w,{className:"h-full shadow-md",children:e.jsxs(I,{children:[e.jsxs(r,{className:"flex items-center mb-3",children:[e.jsx(ve,{className:"mr-2 text-blue-500"}),e.jsx(x,{variant:"h6",className:"font-bold",children:o("home.recentlyPlayed","最近游玩")})]}),c.loading?e.jsx(r,{className:"max-h-44vh overflow-y-auto pr-1",children:[1,2,3,4].map(t=>e.jsxs(r,{className:"flex items-center mb-3",children:[e.jsx(g,{variant:"rounded",width:40,height:40,className:"mr-3"}),e.jsxs(r,{className:"flex-1",children:[e.jsx(g,{width:"80%",height:20}),e.jsx(g,{width:"60%",height:16})]})]},t))}):e.jsx(k,{className:"max-h-44vh overflow-y-auto pr-1",children:c.sessions.map((t,d)=>e.jsxs(M.Fragment,{children:[e.jsxs(R,{className:"px-0 text-inherit",component:A,to:`/libraries/${t.game_id}`,children:[e.jsx(H,{children:e.jsx(L,{variant:"rounded",src:t.imageUrl})}),e.jsx(V,{primary:t.gameTitle,secondary:o("home.lastPlayed",{time:C(t.end_time)})})]}),d!==c.sessions.length-1&&e.jsx(z,{})]},t.session_id))})]})})}),e.jsx(r,{className:"col-span-12 md:col-span-6 lg:col-span-3",children:e.jsx(w,{className:"h-full shadow-md",children:e.jsxs(I,{children:[e.jsxs(r,{className:"flex items-center mb-3",children:[e.jsx(xe,{className:"mr-2 text-green-500"}),e.jsx(x,{variant:"h6",className:"font-bold",children:o("home.recentlyAdded","最近添加")})]}),c.loading?e.jsx(r,{className:"max-h-44vh overflow-y-auto pr-1",children:[1,2,3,4].map(t=>e.jsxs(r,{className:"flex items-center mb-3",children:[e.jsx(g,{variant:"rounded",width:40,height:40,className:"mr-3"}),e.jsxs(r,{className:"flex-1",children:[e.jsx(g,{width:"80%",height:20}),e.jsx(g,{width:"60%",height:16})]})]},t))}):e.jsx(k,{className:"max-h-44vh overflow-y-auto pr-1",children:c.added.map((t,d)=>e.jsxs(M.Fragment,{children:[e.jsxs(R,{className:"px-0 text-inherit",component:A,to:`/libraries/${t.id}`,children:[e.jsx(H,{children:e.jsx(L,{variant:"rounded",src:t.imageUrl})}),e.jsx(V,{primary:t.title,secondary:o("home.addedAt",{time:t.time?C(t.time):""})})]}),d!==c.added.length-1&&e.jsx(z,{})]},t.id))})]})})})]})]})};export{Ie as Home};
