const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-8LpMZBdz.js","./index-CPV8Wz17.css"])))=>i.map(i=>d[i]);
import{r as u,a as te,g as ne,u as oe,ab as Ne,y as U,c as H,s as M,ac as we,j as e,b as re,P as Pe,m as F,z as Be,e as Ae,ad as J,ae as Te,af as Z,a6 as De,B as h,D as C,i as j,f as P,ag as f,a8 as N,ah as ie,ai as Ue,aj as Ie,ak as Me,al as k,am as de,F as I,an as w,ao as E,ap as pe,aq as O,T as v,ar as Re,J as ee,N as L,a7 as z,as as $e,at as Le,au as se,av as ce,aw as m,ax as ae,ay as q,az as ge,aA as Fe,aB as Ee,aC as Ge,aa as le}from"./index-8LpMZBdz.js";import{B as Ve}from"./Backup-saa6L5ZB.js";import{S as ue}from"./Save-4_kBfRSx.js";import{u as ze}from"./useScrollRestore-D7epZdB6.js";import{m as We,c as _e}from"./index-OSLxvytU.js";const me=u.createContext({});function He(s){return ne("MuiAccordion",s)}const _=te("MuiAccordion",["root","heading","rounded","expanded","disabled","gutters","region"]),Oe=s=>{const{classes:a,square:t,expanded:n,disabled:o,disableGutters:r}=s;return re({root:["root",!t&&"rounded",n&&"expanded",o&&"disabled",!r&&"gutters"],heading:["heading"],region:["region"]},He,a)},qe=M(Pe,{name:"MuiAccordion",slot:"Root",overridesResolver:(s,a)=>{const{ownerState:t}=s;return[{[`& .${_.region}`]:a.region},a.root,!t.square&&a.rounded,!t.disableGutters&&a.gutters]}})(F(({theme:s})=>{const a={duration:s.transitions.duration.shortest};return{position:"relative",transition:s.transitions.create(["margin"],a),overflowAnchor:"none","&::before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:(s.vars||s).palette.divider,transition:s.transitions.create(["opacity","background-color"],a)},"&:first-of-type":{"&::before":{display:"none"}},[`&.${_.expanded}`]:{"&::before":{opacity:0},"&:first-of-type":{marginTop:0},"&:last-of-type":{marginBottom:0},"& + &":{"&::before":{display:"none"}}},[`&.${_.disabled}`]:{backgroundColor:(s.vars||s).palette.action.disabledBackground}}}),F(({theme:s})=>({variants:[{props:a=>!a.square,style:{borderRadius:0,"&:first-of-type":{borderTopLeftRadius:(s.vars||s).shape.borderRadius,borderTopRightRadius:(s.vars||s).shape.borderRadius},"&:last-of-type":{borderBottomLeftRadius:(s.vars||s).shape.borderRadius,borderBottomRightRadius:(s.vars||s).shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}}},{props:a=>!a.disableGutters,style:{[`&.${_.expanded}`]:{margin:"16px 0"}}}]}))),Je=M("h3",{name:"MuiAccordion",slot:"Heading"})({all:"unset"}),Ye=M("div",{name:"MuiAccordion",slot:"Region"})({}),Ke=u.forwardRef(function(a,t){const n=oe({props:a,name:"MuiAccordion"}),{children:o,className:r,defaultExpanded:i=!1,disabled:l=!1,disableGutters:x=!1,expanded:p,onChange:b,square:d=!1,slots:c={},slotProps:g={},TransitionComponent:S,TransitionProps:W,...Y}=n,[y,B]=Ne({controlled:p,default:i,name:"Accordion",state:"expanded"}),R=u.useCallback(Ce=>{B(!y),b&&b(Ce,!y)},[y,b,B]),[G,...K]=u.Children.toArray(o),Q=u.useMemo(()=>({expanded:y,disabled:l,disableGutters:x,toggle:R}),[y,l,x,R]),A={...n,square:d,disabled:l,disableGutters:x,expanded:y},V=Oe(A),X={transition:S,...c},T={transition:W,...g},D={slots:X,slotProps:T},[xe,be]=U("root",{elementType:qe,externalForwardedProps:{...D,...Y},className:H(V.root,r),shouldForwardComponentProp:!0,ownerState:A,ref:t,additionalProps:{square:d}}),[Se,je]=U("heading",{elementType:Je,externalForwardedProps:D,className:V.heading,ownerState:A}),[fe,ye]=U("transition",{elementType:we,externalForwardedProps:D,ownerState:A}),[ve,ke]=U("region",{elementType:Ye,externalForwardedProps:D,ownerState:A,className:V.region,additionalProps:{"aria-labelledby":G.props.id,id:G.props["aria-controls"],role:"region"}});return e.jsxs(xe,{...be,children:[e.jsx(Se,{...je,children:e.jsx(me.Provider,{value:Q,children:G})}),e.jsx(fe,{in:y,timeout:"auto",...ye,children:e.jsx(ve,{...ke,children:K})})]})});function Qe(s){return ne("MuiAccordionDetails",s)}te("MuiAccordionDetails",["root"]);const Xe=s=>{const{classes:a}=s;return re({root:["root"]},Qe,a)},Ze=M("div",{name:"MuiAccordionDetails",slot:"Root"})(F(({theme:s})=>({padding:s.spacing(1,2,2)}))),es=u.forwardRef(function(a,t){const n=oe({props:a,name:"MuiAccordionDetails"}),{className:o,...r}=n,i=n,l=Xe(i);return e.jsx(Ze,{className:H(l.root,o),ref:t,ownerState:i,...r})});function ss(s){return ne("MuiAccordionSummary",s)}const $=te("MuiAccordionSummary",["root","expanded","focusVisible","disabled","gutters","contentGutters","content","expandIconWrapper"]),as=s=>{const{classes:a,expanded:t,disabled:n,disableGutters:o}=s;return re({root:["root",t&&"expanded",n&&"disabled",!o&&"gutters"],focusVisible:["focusVisible"],content:["content",t&&"expanded",!o&&"contentGutters"],expandIconWrapper:["expandIconWrapper",t&&"expanded"]},ss,a)},ts=M(Be,{name:"MuiAccordionSummary",slot:"Root"})(F(({theme:s})=>{const a={duration:s.transitions.duration.shortest};return{display:"flex",width:"100%",minHeight:48,padding:s.spacing(0,2),transition:s.transitions.create(["min-height","background-color"],a),[`&.${$.focusVisible}`]:{backgroundColor:(s.vars||s).palette.action.focus},[`&.${$.disabled}`]:{opacity:(s.vars||s).palette.action.disabledOpacity},[`&:hover:not(.${$.disabled})`]:{cursor:"pointer"},variants:[{props:t=>!t.disableGutters,style:{[`&.${$.expanded}`]:{minHeight:64}}}]}})),ns=M("span",{name:"MuiAccordionSummary",slot:"Content"})(F(({theme:s})=>({display:"flex",textAlign:"start",flexGrow:1,margin:"12px 0",variants:[{props:a=>!a.disableGutters,style:{transition:s.transitions.create(["margin"],{duration:s.transitions.duration.shortest}),[`&.${$.expanded}`]:{margin:"20px 0"}}}]}))),os=M("span",{name:"MuiAccordionSummary",slot:"ExpandIconWrapper"})(F(({theme:s})=>({display:"flex",color:(s.vars||s).palette.action.active,transform:"rotate(0deg)",transition:s.transitions.create("transform",{duration:s.transitions.duration.shortest}),[`&.${$.expanded}`]:{transform:"rotate(180deg)"}}))),rs=u.forwardRef(function(a,t){const n=oe({props:a,name:"MuiAccordionSummary"}),{children:o,className:r,expandIcon:i,focusVisibleClassName:l,onClick:x,slots:p,slotProps:b,...d}=n,{disabled:c=!1,disableGutters:g,expanded:S,toggle:W}=u.useContext(me),Y=T=>{W&&W(T),x&&x(T)},y={...n,expanded:S,disabled:c,disableGutters:g},B=as(y),R={slots:p,slotProps:b},[G,K]=U("root",{ref:t,shouldForwardComponentProp:!0,className:H(B.root,r),elementType:ts,externalForwardedProps:{...R,...d},ownerState:y,additionalProps:{focusRipple:!1,disableRipple:!0,disabled:c,"aria-expanded":S,focusVisibleClassName:H(B.focusVisible,l)},getSlotProps:T=>({...T,onClick:D=>{T.onClick?.(D),Y(D)}})}),[Q,A]=U("content",{className:B.content,elementType:ns,externalForwardedProps:R,ownerState:y}),[V,X]=U("expandIconWrapper",{className:B.expandIconWrapper,elementType:os,externalForwardedProps:R,ownerState:y});return e.jsxs(G,{...K,children:[e.jsx(Q,{...A,children:o}),i&&e.jsx(V,{...X,children:i})]})}),is=Ae(e.jsx("path",{d:"m7 10 5 5 5-5z"}));async function he(){return await J("plugin:autostart|is_enabled")}async function cs(){await J("plugin:autostart|enable")}async function ls(){await J("plugin:autostart|disable")}const ds=async()=>{try{await he()?ls():await cs()}catch(s){console.error("Error toggling autostart:",s)}};async function ps(s){const a=await Te();function t(){const i=new Date,l=x=>String(x).padStart(2,"0");return`${i.getFullYear()}${l(i.getMonth()+1)}${l(i.getDate())}_${l(i.getHours())}${l(i.getMinutes())}${l(i.getSeconds())}`}const o=`reina_manager_${t()}.db`,r=`data/backups/${o}`;try{return s===""||s===void 0?(await We("data/backups",{baseDir:Z.AppData,recursive:!0}),await _e("data/reina_manager.db",r,{fromPathBaseDir:Z.AppData,toPathBaseDir:Z.AppData}),console.log(`数据库已备份到: ${r}`),r):(await J("copy_file",{src:`${a}/data/reina_manager.db`,dst:`${s}/${o}`}),`${s}/${o}`)}catch(i){throw console.error("备份数据库失败:",i),i}}const gs=()=>{const{t:s,i18n:a}=j(),t={"zh-CN":"简体中文(zh-CN)","zh-TW":"繁体中文(zh-TW)","en-US":"English(en-US)","ja-JP":"日本語(ja-JP)"},n=o=>{const r=o.target.value;a.changeLanguage(r)};return e.jsxs(h,{className:"min-w-30 mb-6",children:[e.jsx(f,{id:"language-select-label",className:"mb-2 font-semibold",children:s("pages.Settings.language")}),e.jsxs(de,{labelId:"language-select-label",id:"language-select",value:a.language,onChange:n,className:"w-60",renderValue:o=>t[o],children:[e.jsx(I,{value:"zh-CN",children:"简体中文(zh-CN)"}),e.jsx(I,{value:"zh-TW",children:"繁体中文(zh-TW)"}),e.jsx(I,{value:"en-US",children:"English(en-US)"}),e.jsx(I,{value:"ja-JP",children:"日本語(ja-JP)"})]})]})},us=()=>{const{t:s}=j(),{bgmToken:a,setBgmToken:t}=P(),[n,o]=u.useState("");u.useEffect(()=>{o(a)},[a]);const r=()=>{ae("https://next.bgm.tv/demo/access-token/create")},i=()=>{try{t(n),m.success(s("pages.Settings.bgmTokenSettings.saveSuccess","BGM Token 保存成功"))}catch(x){console.error(x),m.error(s("pages.Settings.bgmTokenSettings.saveError","BGM Token 保存失败"))}},l=()=>{o("")};return e.jsxs(h,{className:"mb-8",children:[e.jsx(f,{className:"font-semibold mb-4",children:s("pages.Settings.bgmToken")}),e.jsxs(N,{direction:"row",spacing:2,alignItems:"center",flexWrap:"wrap",children:[e.jsx(ie,{autoComplete:"off",placeholder:s("pages.Settings.tokenPlaceholder"),value:n,onChange:x=>o(x.target.value),variant:"outlined",size:"medium",className:"min-w-60",slotProps:{htmlInput:{style:{WebkitTextSecurity:"disc",textSecurity:"disc"}},input:{endAdornment:n&&e.jsx(Ue,{position:"end",children:e.jsx(Ie,{onClick:l,edge:"end",size:"small","aria-label":s("pages.Settings.bgmTokenSettings.clearToken","清除令牌"),children:e.jsx(Me,{})})})}}}),e.jsx(k,{variant:"contained",color:"primary",onClick:i,className:"px-6 py-2",children:s("pages.Settings.saveBtn")}),e.jsx(k,{variant:"outlined",color:"primary",onClick:r,className:"px-6 py-2",children:s("pages.Settings.getToken")})]})]})},ms=()=>{const{t:s}=j(),[a,t]=u.useState(!1);return u.useEffect(()=>{(async()=>{t(await he())})()},[]),e.jsx(h,{className:"mb-6",children:e.jsxs(N,{direction:"row",alignItems:"center",className:"min-w-60",children:[e.jsx(h,{children:e.jsx(f,{className:"font-semibold mb-1",children:s("pages.Settings.autoStart")})}),e.jsx(E,{checked:a,onChange:()=>{t(!a),ds()},color:"primary"})]})})},hs=()=>{const{t:s}=j(),{nsfwFilter:a,setNsfwFilter:t,nsfwCoverReplace:n,setNsfwCoverReplace:o}=P();return e.jsxs(h,{className:"mb-6",children:[e.jsx(f,{className:"font-semibold mb-4",children:s("pages.Settings.nsfw.title")}),e.jsxs(h,{className:"pl-2",children:[e.jsx(w,{control:e.jsx(E,{checked:a,onChange:r=>t(r.target.checked),color:"primary"}),label:s("pages.Settings.nsfw.filter")}),e.jsx(w,{control:e.jsx(E,{checked:n,onChange:r=>o(r.target.checked),color:"primary"}),label:s("pages.Settings.nsfw.coverReplace")})]})]})},xs=()=>{const{t:s}=j();return e.jsxs(h,{className:"mb-6",children:[e.jsx(f,{className:"font-semibold mb-4",children:s("pages.Settings.vndbData.title","VNDB 数据设置")}),e.jsxs(h,{className:"pl-2 space-y-4",children:[e.jsx(bs,{}),e.jsx(C,{sx:{my:2}}),e.jsx(Ss,{})]})]})},bs=()=>{const{t:s}=j(),{tagTranslation:a,setTagTranslation:t}=P();return e.jsx(h,{className:"mb-6",children:e.jsxs(N,{direction:"row",alignItems:"center",className:"min-w-60",children:[e.jsxs(h,{children:[e.jsx(f,{className:"font-semibold mb-1",children:s("pages.Settings.tagTranslation.title")}),e.jsx(v,{variant:"caption",color:"text.secondary",children:s("pages.Settings.tagTranslation.description")})]}),e.jsx(E,{checked:a,onChange:n=>t(n.target.checked),color:"primary"})]})})},Ss=()=>{const{t:s}=j(),{spoilerLevel:a,setSpoilerLevel:t}=P();return e.jsx(h,{className:"mb-6",children:e.jsxs(N,{direction:"row",alignItems:"center",spacing:1,children:[e.jsxs(h,{children:[e.jsx(f,{className:"font-semibold mb-1",children:s("pages.Settings.spoilerLevel.title")}),e.jsx(v,{variant:"caption",color:"text.secondary",children:s("pages.Settings.spoilerLevel.description")})]}),e.jsxs(de,{value:a,onChange:n=>t(n.target.value),className:"min-w-40",size:"small",children:[e.jsx(I,{value:0,children:s("pages.Settings.spoilerLevel.level0")}),e.jsx(I,{value:1,children:s("pages.Settings.spoilerLevel.level1")}),e.jsx(I,{value:2,children:s("pages.Settings.spoilerLevel.level2")})]})]})})},js=()=>{const{t:s}=j(),{cardClickMode:a,setCardClickMode:t,doubleClickLaunch:n,setDoubleClickLaunch:o,longPressLaunch:r,setLongPressLaunch:i}=P();return e.jsxs(h,{className:"mb-6",children:[e.jsx(f,{className:"font-semibold mb-4",children:s("pages.Settings.cardClickMode.title")}),e.jsxs(h,{className:"pl-2",children:[e.jsxs(pe,{value:a,onChange:l=>t(l.target.value),className:"pl-2",children:[e.jsx(w,{value:"navigate",control:e.jsx(O,{color:"primary"}),label:s("pages.Settings.cardClickMode.navigate"),className:"mb-1"}),e.jsx(w,{value:"select",control:e.jsx(O,{color:"primary"}),label:s("pages.Settings.cardClickMode.select"),className:"mb-1"})]}),e.jsxs(h,{className:"mt-4 pl-2",children:[e.jsx(w,{control:e.jsx(E,{checked:n,onChange:l=>o(l.target.checked),color:"primary"}),label:s("pages.Settings.cardClickMode.doubleClickLaunch"),className:"mb-1"}),n&&a==="navigate"&&e.jsx(v,{variant:"caption",color:"text.secondary",className:"block ml-8",children:s("pages.Settings.cardClickMode.doubleClickLaunchNote")})]}),e.jsxs(h,{className:"mt-4 pl-2",children:[e.jsx(w,{control:e.jsx(E,{checked:r,onChange:l=>i(l.target.checked),color:"primary"}),label:s("pages.Settings.cardClickMode.longPressLaunch"),className:"mb-1"}),r&&e.jsx(v,{variant:"caption",color:"text.secondary",className:"block ml-8",children:s("pages.Settings.cardClickMode.longPressLaunchNote")})]})]})]})},fs=()=>{const{t:s}=j(),{skipCloseRemind:a,defaultCloseAction:t,setSkipCloseRemind:n,setDefaultCloseAction:o}=P();return e.jsxs(h,{className:"mb-6",children:[e.jsx(f,{className:"font-semibold mb-4",children:s("pages.Settings.closeSettings")}),e.jsxs(h,{className:"pl-2",children:[e.jsx(w,{control:e.jsx(Re,{checked:a,onChange:r=>n(r.target.checked),color:"primary"}),label:s("pages.Settings.skipCloseRemind"),className:"mb-2"}),e.jsxs(pe,{value:t,onChange:r=>o(r.target.value),className:"pl-4",children:[e.jsx(w,{value:"hide",control:e.jsx(O,{color:"primary"}),label:s("pages.Settings.closeToTray"),disabled:!a,className:a?"":"opacity-50 transition-opacity duration-200"}),e.jsx(w,{value:"close",control:e.jsx(O,{color:"primary"}),label:s("pages.Settings.closeApp"),disabled:!a,className:a?"":"opacity-50 transition-opacity duration-200"})]})]})]})},ys=()=>{const{t:s}=j(),[a,t]=u.useState(!1),[n,o]=u.useState(""),[r,i]=u.useState(!1);u.useEffect(()=>{(async()=>{i(!0);try{const c=await q.getDbBackupPath();o(c)}catch(c){console.error("加载数据库备份路径失败",c)}finally{i(!1)}})()},[]);const l=async()=>{t(!0);try{const d=await ps(n);m.success(s("pages.Settings.databaseBackup.backupSuccess",`数据库备份成功: ${d}`))}catch(d){const c=d instanceof Error?d.message:s("pages.Settings.databaseBackup.backupFailed","备份失败");m.error(s("pages.Settings.databaseBackup.backupError",`数据库备份失败: ${c}`))}finally{t(!1)}},x=async()=>{try{await Ee(n)}catch(d){const c=d instanceof Error?d.message:s("pages.Settings.databaseBackup.openFolderFailed","打开文件夹失败");m.error(s("pages.Settings.databaseBackup.openFolderError",`打开备份文件夹失败: ${c}`))}},p=async()=>{i(!0);try{await q.setDbBackupPath(n),m.success(s("pages.Settings.databaseBackup.savePathSuccess","备份路径已保存"))}catch(d){console.error(d),m.error(s("pages.Settings.databaseBackup.savePathError","保存失败"))}finally{i(!1)}},b=async()=>{try{const d=await ge();d&&o(d)}catch(d){console.error(d),m.error(s("pages.Settings.databaseBackup.selectFolderError","选择文件夹失败"))}};return e.jsxs(h,{className:"mb-6",children:[e.jsx(f,{className:"font-semibold mb-4",children:s("pages.Settings.databaseBackup.title","数据库备份")}),e.jsxs(N,{direction:"row",spacing:2,alignItems:"center",className:"mb-3",children:[e.jsx(ie,{label:s("pages.Settings.databaseBackup.pathLabel","数据库备份保存路径"),variant:"outlined",value:n,onChange:d=>o(d.target.value),className:"min-w-60 flex-grow",placeholder:s("pages.Settings.databaseBackup.pathPlaceholder","选择或输入保存路径"),disabled:r}),e.jsx(k,{variant:"outlined",onClick:b,disabled:r||!L(),startIcon:e.jsx(ee,{}),className:"px-4 py-2",children:s("pages.Settings.databaseBackup.selectFolder","选择目录")}),e.jsx(k,{variant:"contained",color:"primary",onClick:p,startIcon:e.jsx(ue,{}),className:"px-4 py-2 ml-2",children:s("pages.Settings.databaseBackup.savePathBtn","保存")})]}),e.jsxs(N,{direction:"row",spacing:2,alignItems:"center",flexWrap:"wrap",children:[e.jsx(k,{variant:"contained",color:"primary",onClick:l,disabled:a||!L(),startIcon:a?e.jsx(z,{size:16,color:"inherit"}):e.jsx(Ve,{}),className:"px-6 py-2",children:a?s("pages.Settings.databaseBackup.backing","备份中..."):s("pages.Settings.databaseBackup.backup","备份数据库")}),e.jsx(k,{variant:"outlined",color:"primary",onClick:x,startIcon:e.jsx(ee,{}),className:"px-6 py-2",disabled:!L(),children:s("pages.Settings.databaseBackup.openFolder","打开备份文件夹")})]})]})},vs=()=>{const{t:s}=j(),[a,t]=u.useState(""),[n,o]=u.useState(!1),[r,i]=u.useState("");u.useEffect(()=>{(async()=>{try{const b=await q.getSaveRootPath();t(b),i(b)}catch(b){console.error("加载备份路径失败:",b)}})()},[]);const l=async()=>{try{const p=await ge();p&&t(p)}catch(p){console.error(p),m.error(s("pages.Settings.savePath.selectFolderError","选择文件夹失败"))}},x=async()=>{o(!0);try{if(await q.setSaveRootPath(a),r!==a||r!==""){m.warning(s("pages.Settings.savePath.movingBackups","正在移动备份文件夹到新位置..."));const p=await Fe(r,a);p.moved?(m.success(s("pages.Settings.savePath.moveSuccess","备份路径保存成功，备份文件夹已移动到新位置")),i(a)):m.warning(s("pages.Settings.savePath.moveWarning",`备份路径已保存，但移动备份文件夹时出现问题: ${p.message}`))}else m.success(s("pages.Settings.savePath.saveSuccess","备份路径保存成功"))}catch(p){const b=p instanceof Error?p.message:s("pages.Settings.savePath.saveFailed","保存失败");m.error(s("pages.Settings.savePath.saveError",`保存备份路径失败: ${b}`))}finally{o(!1)}};return e.jsxs(h,{className:"mb-6",children:[e.jsx(f,{className:"font-semibold mb-4",children:s("pages.Settings.savePath.title","游戏存档备份路径")}),e.jsxs(N,{direction:"row",spacing:2,alignItems:"center",flexWrap:"wrap",children:[e.jsx(ie,{label:s("pages.Settings.savePath.pathLabel","备份根目录路径"),variant:"outlined",value:a,onChange:p=>t(p.target.value),className:"min-w-60 flex-grow",placeholder:s("pages.Settings.savePath.pathPlaceholder","选择游戏存档备份的根目录"),disabled:n}),e.jsx(k,{variant:"outlined",onClick:l,disabled:n||!L(),startIcon:e.jsx(ee,{}),className:"px-4 py-2",children:s("pages.Settings.savePath.selectFolder","选择目录")}),e.jsx(k,{variant:"contained",color:"primary",onClick:x,disabled:n||!a.trim(),startIcon:n?e.jsx(z,{size:16,color:"inherit"}):e.jsx(ue,{}),className:"px-6 py-2",children:n?s("pages.Settings.savePath.saving","保存中..."):s("pages.Settings.saveBtn")})]})]})},ks=()=>{const{t:s}=j(),{triggerUpdateModal:a}=P(),[t,n]=u.useState(!1),[o,r]=u.useState(""),i=async()=>{n(!0),r("");try{await Ge({onUpdateFound:p=>{r(`发现新版本: ${p.version}`),a(p)},onNoUpdate:()=>{r("当前已是最新版本")},onError:p=>{r(`检查更新失败: ${p}`)}})}catch(p){r(`检查更新出错: ${p}`)}finally{n(!1)}},l=()=>{ae("https://github.com/huoshen80/ReinaManager")},x=()=>{ae("https://huoshen80.xin")};return e.jsxs(h,{className:"mb-6",children:[e.jsx(f,{className:"font-semibold mb-4",children:s("pages.Settings.about.title","关于")}),e.jsxs(h,{className:"pl-2 space-y-3",children:[e.jsxs(N,{direction:"row",alignItems:"center",spacing:2,children:[e.jsxs(v,{variant:"body2",children:[e.jsxs("strong",{children:[s("pages.Settings.about.version","版本"),": "]}),"v",Le.version]}),e.jsx(k,{variant:"outlined",startIcon:t?e.jsx(z,{size:16,color:"inherit"}):e.jsx(se,{}),onClick:i,disabled:t,size:"small",children:t?s("pages.Settings.about.checking","检查中..."):s("pages.Settings.about.checkUpdate","检查更新")})]}),o&&e.jsx(v,{variant:"body2",color:o.includes("失败")||o.includes("出错")?"error":"primary",children:o}),e.jsxs(v,{variant:"body2",children:[e.jsxs("strong",{children:[s("pages.Settings.about.author","作者"),": "]}),"huoshen80"]}),e.jsxs(v,{variant:"body2",children:[e.jsxs("strong",{children:[s("pages.Settings.about.github","项目地址"),": "]}),e.jsx(ce,{component:"button",variant:"body2",onClick:l,sx:{textDecoration:"none"},children:"https://github.com/huoshen80/ReinaManager"})]}),e.jsxs(v,{variant:"body2",children:[e.jsxs("strong",{children:[s("pages.Settings.about.blog","作者博客"),": "]}),e.jsx(ce,{component:"button",variant:"body2",onClick:x,sx:{textDecoration:"none"},children:"https://huoshen80.xin"})]})]})]})},Cs=()=>{const{t:s}=j();return e.jsxs(Ke,{children:[e.jsx(rs,{expandIcon:e.jsx(is,{}),"aria-controls":"panel2-content",id:"panel2-header",children:e.jsx($e,{title:s("pages.Settings.dev.tooltip","以下功能为实验性功能，请谨慎使用"),children:e.jsx(v,{component:"span",children:s("pages.Settings.dev.title","实验性功能")})})}),e.jsx(es,{children:e.jsx(Ns,{})})]})},Ns=()=>{const{t:s}=j(),{bgmToken:a}=P(),[t,n]=u.useState(!1),[o,r]=u.useState(!1),[i,l]=u.useState(""),x=async()=>{n(!0),l("");try{const{batchUpdateVndbData:d}=await le(async()=>{const{batchUpdateVndbData:g}=await import("./index-8LpMZBdz.js").then(S=>S.b7);return{batchUpdateVndbData:g}},__vite__mapDeps([0,1]),import.meta.url);m.info(s("pages.Settings.batchUpdate.updating","正在批量更新 VNDB 数据..."));const c=await d();if(c.success>0){const g=s("pages.Settings.batchUpdate.success",`成功更新 ${c.success}/${c.total} 个游戏`,{success:c.success,total:c.total});l(g),m.success(g)}if(c.failed>0){const g=s("pages.Settings.batchUpdate.partialFailed",`${c.failed} 个游戏更新失败`,{failed:c.failed});l(S=>S?`${S}
${g}`:g),m.warning(g)}if(c.total===0){const g=s("pages.Settings.batchUpdate.noGames","没有找到包含 VNDB ID 的游戏");l(g),m.info(g)}}catch(d){const c=d instanceof Error?d.message:s("pages.Settings.batchUpdate.failed","批量更新失败");l(c),m.error(s("pages.Settings.batchUpdate.error",`批量更新 VNDB 数据失败: ${c}`))}finally{n(!1)}},p=async()=>{r(!0),l("");try{const{batchUpdateBgmData:d}=await le(async()=>{const{batchUpdateBgmData:g}=await import("./index-8LpMZBdz.js").then(S=>S.b7);return{batchUpdateBgmData:g}},__vite__mapDeps([0,1]),import.meta.url);if(m.info(s("pages.Settings.batchUpdate.updatingBgm","正在批量更新 BGM 数据...")),a.trim()==="")throw new Error(s("pages.Settings.batchUpdate.noBgmToken","更新失败：未设置 BGM Token"));const c=await d(a);if(c.success>0){const g=s("pages.Settings.batchUpdate.success",`成功更新 ${c.success}/${c.total} 个游戏`,{success:c.success,total:c.total});l(g),m.success(g)}if(c.failed>0){const g=s("pages.Settings.batchUpdate.partialFailed",`${c.failed} 个游戏更新失败`,{failed:c.failed});l(S=>S?`${S}
${g}`:g),m.warning(g)}if(c.total===0){const g=s("pages.Settings.batchUpdate.noBgmGames","没有找到包含 BGM ID 的游戏");l(g),m.info(g)}}catch(d){const c=d instanceof Error?d.message:s("pages.Settings.batchUpdate.failed","批量更新失败");l(c),m.error(s("pages.Settings.batchUpdate.errorBgm",`批量更新 BGM 数据失败: ${c}`,{message:c}))}finally{r(!1)}},b=t||o;return e.jsxs(h,{className:"mb-6",children:[e.jsx(f,{className:"font-semibold mb-4",children:s("pages.Settings.batchUpdate.title","批量更新数据")}),e.jsxs(N,{direction:"column",spacing:2,children:[e.jsx(v,{variant:"caption",className:"mb-2",children:s("pages.Settings.batchUpdate.description","批量更新功能可用于更新已存在游戏的 BGM/VNDB 数据。当游戏的元数据发生变化时，您可以使用此功能来同步最新的信息。一旦点击更新按钮请耐心等待，更新过程可能需要一些时间。推荐软件更新数据源获取字段时使用。")}),e.jsxs(N,{direction:"row",spacing:2,alignItems:"center",flexWrap:"wrap",children:[e.jsx(k,{variant:"contained",color:"info",onClick:p,disabled:b||!L(),startIcon:o?e.jsx(z,{size:16,color:"inherit"}):e.jsx(se,{}),className:"px-6 py-2",children:o?s("pages.Settings.batchUpdate.updating","更新中..."):s("pages.Settings.batchUpdate.updateBgm","批量更新 BGM 数据")}),e.jsx(k,{variant:"contained",color:"primary",onClick:x,disabled:b||!L(),startIcon:t?e.jsx(z,{size:16,color:"inherit"}):e.jsx(se,{}),className:"px-6 py-2",children:t?s("pages.Settings.batchUpdate.updating","更新中..."):s("pages.Settings.batchUpdate.updateVndb","批量更新 VNDB 数据")})]}),i&&e.jsx(v,{variant:"body2",color:i.includes("失败")||i.includes("fail")||i.includes("错误")||i.includes("error")?"error":"primary",className:"whitespace-pre-line",children:i})]})]})},Ds=()=>(ze("/settings"),e.jsx(De,{className:"max-w-full",children:e.jsxs(h,{className:"py-4",children:[e.jsx(us,{}),e.jsx(C,{sx:{my:3}}),e.jsx(gs,{}),e.jsx(C,{sx:{my:3}}),e.jsx(xs,{}),e.jsx(C,{sx:{my:3}}),e.jsx(hs,{}),e.jsx(C,{sx:{my:3}}),e.jsx(js,{}),e.jsx(C,{sx:{my:3}}),e.jsx(ms,{}),e.jsx(C,{sx:{my:3}}),e.jsx(fs,{}),e.jsx(C,{sx:{my:3}}),e.jsx(vs,{}),e.jsx(C,{sx:{my:3}}),e.jsx(ys,{}),e.jsx(C,{sx:{my:3}}),e.jsx(Cs,{}),e.jsx("br",{}),e.jsx(ks,{})]})}));export{Ds as Settings};
