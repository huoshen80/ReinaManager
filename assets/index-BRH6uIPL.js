import{g as F,a as B,r as j,u as W,j as e,c as X,b as K,s as Y,m as q,k as D,d as G,e as b,f as O,h as J,i as Q,l as I,n as _,P as Z,C as ee,o as S,B as n,T as p,L as C,p as M,R,q as P,t as z,A as H,v as k,D as V,w as L,x as se}from"./index-D1SIH30A.js";import{S as te,A as ae,T as ie}from"./Today-DFaTUCTj.js";import{C as N}from"./Card-CXRbG3bK.js";import{C as A}from"./CardContent-CHLnZwAB.js";function ne(a){return String(a).match(/[\d.\-+]*\s*(.*)/)[1]||""}function oe(a){return parseFloat(a)}function le(a){return F("MuiSkeleton",a)}B("MuiSkeleton",["root","text","rectangular","rounded","circular","pulse","wave","withChildren","fitContent","heightAuto"]);const re=a=>{const{classes:l,variant:o,animation:r,hasChildren:y,width:h,height:x}=a;return K({root:["root",o,r,y&&"withChildren",y&&!h&&"fitContent",y&&!x&&"heightAuto"]},le,l)},$=D`
  0% {
    opacity: 1;
  }

  50% {
    opacity: 0.4;
  }

  100% {
    opacity: 1;
  }
`,U=D`
  0% {
    transform: translateX(-100%);
  }

  50% {
    /* +0.5s of delay between each loop */
    transform: translateX(100%);
  }

  100% {
    transform: translateX(100%);
  }
`,ce=typeof $!="string"?G`
        animation: ${$} 2s ease-in-out 0.5s infinite;
      `:null,de=typeof U!="string"?G`
        &::after {
          animation: ${U} 2s linear 0.5s infinite;
        }
      `:null,me=Y("span",{name:"MuiSkeleton",slot:"Root",overridesResolver:(a,l)=>{const{ownerState:o}=a;return[l.root,l[o.variant],o.animation!==!1&&l[o.animation],o.hasChildren&&l.withChildren,o.hasChildren&&!o.width&&l.fitContent,o.hasChildren&&!o.height&&l.heightAuto]}})(q(({theme:a})=>{const l=ne(a.shape.borderRadius)||"px",o=oe(a.shape.borderRadius);return{display:"block",backgroundColor:a.vars?a.vars.palette.Skeleton.bg:a.alpha(a.palette.text.primary,a.palette.mode==="light"?.11:.13),height:"1.2em",variants:[{props:{variant:"text"},style:{marginTop:0,marginBottom:0,height:"auto",transformOrigin:"0 55%",transform:"scale(1, 0.60)",borderRadius:`${o}${l}/${Math.round(o/.6*10)/10}${l}`,"&:empty:before":{content:'"\\00a0"'}}},{props:{variant:"circular"},style:{borderRadius:"50%"}},{props:{variant:"rounded"},style:{borderRadius:(a.vars||a).shape.borderRadius}},{props:({ownerState:r})=>r.hasChildren,style:{"& > *":{visibility:"hidden"}}},{props:({ownerState:r})=>r.hasChildren&&!r.width,style:{maxWidth:"fit-content"}},{props:({ownerState:r})=>r.hasChildren&&!r.height,style:{height:"auto"}},{props:{animation:"pulse"},style:ce||{animation:`${$} 2s ease-in-out 0.5s infinite`}},{props:{animation:"wave"},style:{position:"relative",overflow:"hidden",WebkitMaskImage:"-webkit-radial-gradient(white, black)","&::after":{background:`linear-gradient(
                90deg,
                transparent,
                ${(a.vars||a).palette.action.hover},
                transparent
              )`,content:'""',position:"absolute",transform:"translateX(-100%)",bottom:0,left:0,right:0,top:0}}},{props:{animation:"wave"},style:de||{"&::after":{animation:`${U} 2s linear 0.5s infinite`}}}]}})),g=j.forwardRef(function(l,o){const r=W({props:l,name:"MuiSkeleton"}),{animation:y="pulse",className:h,component:x="span",height:d,style:w,variant:i="text",width:t,...c}=r,u={...r,animation:y,component:x,variant:i,hasChildren:!!c.children},f=re(u);return e.jsx(me,{as:x,ref:o,className:X(f.root,h),ownerState:u,...c,style:{width:t,height:d,...w}})}),he=b(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m5 11h-4v4h-2v-4H7v-2h4V7h2v4h4z"})),pe=b(e.jsx("path",{d:"M9 11H7v2h2zm4 0h-2v2h2zm4 0h-2v2h2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 16H5V9h14z"})),xe=b(e.jsx("path",{d:"M15 7.5V2H9v5.5l3 3zM7.5 9H2v6h5.5l3-3zM9 16.5V22h6v-5.5l-3-3zM16.5 9l-3 3 3 3H22V9z"})),ue=b(e.jsx("path",{d:"M20 2H4c-1 0-2 .9-2 2v3.01c0 .72.43 1.34 1 1.69V20c0 1.1 1.1 2 2 2h14c.9 0 2-.9 2-2V8.7c.57-.35 1-.97 1-1.69V4c0-1.1-1-2-2-2m-5 12H9v-2h6zm5-7H4V4l16-.02z"})),fe=b(e.jsx("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2m6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1z"})),ve=b(e.jsx("path",{d:"M2 20h20v-4H2zm2-3h2v2H4zM2 4v4h20V4zm4 3H4V5h2zm-4 7h20v-4H2zm2-3h2v2H4z"}));async function ge(a,l){const o=[],r=[],y=a.filter(t=>t.id&&typeof t.id=="number").map(t=>t.id),h=await se(y,10);for(const t of a){if(!t.id||typeof t.id!="number")continue;const c=h.get(t.id)||[],u=_(t,l),f=I(t);for(const v of c.filter(s=>typeof s.end_time=="number")){const s={id:`play-${v.session_id||t.id}-${v.end_time}`,type:"play",gameId:t.id,gameTitle:u,imageUrl:f,time:v.end_time,duration:v.duration};o.push(s),r.push({session_id:v.session_id,game_id:t.id,end_time:v.end_time,gameTitle:u,imageUrl:f})}}const x=[],d=[],w=a.filter(t=>typeof t.id=="number"&&t.created_at);for(const t of w){const c=t.created_at,u=new Date(c*1e3),f=_(t,l),v={id:`add-${t.id}`,type:"add",gameId:t.id,gameTitle:f,imageUrl:I(t),time:c};x.push(v),d.push({id:t.id,title:f,imageUrl:I(t),time:u})}const i=[...o,...x].sort((t,c)=>c.time-t.time);return r.sort((t,c)=>c.end_time-t.end_time),d.sort((t,c)=>t.time&&c.time?c.time.getTime()-t.time.getTime():0),{sessions:r.slice(0,6),added:d.slice(0,6),activities:i.slice(0,10)}}const be=()=>{const{allGames:a}=O(),{getTotalPlayTime:l,getWeekPlayTime:o,getTodayPlayTime:r,statsVersion:y}=J(),[h,x]=j.useState({total:0,week:0,today:0,loading:!0}),[d,w]=j.useState({sessions:[],added:[],activities:[],loading:!0}),{t:i,i18n:t}=Q(),c=j.useMemo(()=>a.map(s=>({title:_(s,t.language),id:s.id,isLocal:s.localpath!=="",imageUrl:I(s)})),[a,t.language]),u=j.useMemo(()=>c.filter(s=>s.isLocal).length,[c]),f=j.useMemo(()=>a.filter(s=>s.clear===Z.PLAYED).length,[a]),v=j.useMemo(()=>[{title:i("home.stats.totalGames","总游戏数"),value:a.length,icon:e.jsx(te,{}),isAsync:!1},{title:i("home.stats.localGames","本地游戏数"),value:u,icon:e.jsx(ve,{}),isAsync:!1},{title:i("home.stats.completedGames","通关游戏数"),value:f,icon:e.jsx(ee,{}),isAsync:!1},{title:i("home.stats.totalPlayTime","总游戏时长"),value:S(h.total),icon:e.jsx(ae,{}),isAsync:!0},{title:i("home.stats.weekPlayTime","本周游戏时长"),value:S(h.week),icon:e.jsx(pe,{}),isAsync:!0},{title:i("home.stats.todayPlayTime","今日游戏时长"),value:S(h.today),icon:e.jsx(ie,{}),isAsync:!0}],[i,a.length,u,f,h]);return j.useEffect(()=>{(async()=>{try{const[m,T,E]=await Promise.all([l(),o(),r()]);x({total:m,week:T,today:E,loading:!1})}catch(m){console.error("获取游戏时长统计失败:",m),x(T=>({...T,loading:!1}))}})()},[l,o,r,y]),j.useEffect(()=>{(async()=>{try{const m=await ge(a,t.language);w({sessions:m.sessions,added:m.added,activities:m.activities,loading:!1})}catch(m){console.error("获取首页活动数据失败:",m),w(T=>({...T,loading:!1}))}})()},[a,t.language]),e.jsxs(n,{className:"p-6 pt-4 flex flex-col gap-4",children:[e.jsx(p,{variant:"h4",children:i("home.title","主页")}),e.jsx(n,{className:"grid grid-cols-12 gap-6",children:v.map(s=>e.jsx(n,{className:"col-span-12 sm:col-span-6 md:col-span-4 lg:col-span-2",children:e.jsx(N,{className:"h-full shadow-md hover:shadow-lg transition-shadow",children:e.jsxs(A,{className:"flex flex-col items-center text-center",children:[s.icon,e.jsx(p,{title:String(s.value),variant:"h6",className:"font-bold mb-1 w-full whitespace-nowrap overflow-hidden text-ellipsis",children:s.isAsync&&h.loading?e.jsx(g,{width:60}):s.value}),e.jsx(p,{variant:"body2",color:"text.secondary",children:s.title})]})})},s.title))}),e.jsxs(n,{className:"grid grid-cols-12 gap-6",children:[e.jsx(n,{className:"col-span-12 md:col-span-6 lg:col-span-3",children:e.jsx(N,{className:"h-full shadow-md",children:e.jsxs(A,{children:[e.jsxs(n,{component:C,to:"/libraries",className:"flex items-center mb-3 text-inherit decoration-none hover:scale-105 hover:shadow-lg cursor-pointer",children:[e.jsx(ue,{className:"mr-2 text-amber-500"}),e.jsx(p,{variant:"h6",className:"font-bold",children:i("home.repository","游戏仓库")})]}),e.jsx(n,{className:"grid grid-cols-1 gap-2 max-h-44vh overflow-y-auto pr-1",children:c.map(s=>e.jsx(N,{variant:"outlined",component:C,to:`/libraries/${s.id}`,sx:{p:1,textAlign:"center",cursor:"pointer",textDecoration:"none","&:hover":{transform:"translateY(-2px)",boxShadow:2}},children:e.jsx(p,{variant:"body2",children:s.title})},s.id))})]})})}),e.jsx(n,{className:"col-span-12 md:col-span-6 lg:col-span-3",children:e.jsx(N,{className:"h-full shadow-md",children:e.jsxs(A,{children:[e.jsxs(n,{className:"flex items-center mb-3",children:[e.jsx(fe,{className:"mr-2 text-purple-500"}),e.jsx(p,{variant:"h6",className:"font-bold",children:i("home.activityTitle","动态")})]}),d.loading?e.jsx(n,{className:"max-h-44vh overflow-y-auto pr-1",children:[1,2,3,4].map(s=>e.jsxs(n,{className:"flex items-center mb-3",children:[e.jsx(g,{variant:"rounded",width:40,height:40,className:"mr-3"}),e.jsxs(n,{className:"flex-1",children:[e.jsx(g,{width:"80%",height:20}),e.jsx(g,{width:"60%",height:16})]})]},s))}):e.jsx(M,{className:"max-h-44vh overflow-y-auto pr-1",children:d.activities.map((s,m)=>e.jsxs(R.Fragment,{children:[e.jsxs(P,{className:"px-0 text-inherit",component:C,to:`/libraries/${s.gameId}`,children:[e.jsx(z,{children:e.jsx(H,{variant:"rounded",src:s.imageUrl})}),e.jsxs(n,{children:[e.jsx(p,{variant:"body1",children:s.type==="add"?i("home.activity.added",{title:s.gameTitle}):i("home.activity.played",{title:s.gameTitle})}),e.jsx(p,{variant:"body2",color:"text.secondary",children:s.type==="add"?i("home.activity.addedAt",{time:k(s.time)}):i("home.activity.playedAtTime",{time:k(s.time)})}),s.type==="play"&&s.duration!==void 0&&e.jsx(p,{variant:"body2",color:"text.secondary",children:i("home.activity.duration",{duration:S(s.duration)})})]})]}),m!==d.activities.length-1&&e.jsx(V,{})]},s.id))})]})})}),e.jsx(n,{className:"col-span-12 md:col-span-6 lg:col-span-3",children:e.jsx(N,{className:"h-full shadow-md",children:e.jsxs(A,{children:[e.jsxs(n,{className:"flex items-center mb-3",children:[e.jsx(xe,{className:"mr-2 text-blue-500"}),e.jsx(p,{variant:"h6",className:"font-bold",children:i("home.recentlyPlayed","最近游玩")})]}),d.loading?e.jsx(n,{className:"max-h-44vh overflow-y-auto pr-1",children:[1,2,3,4].map(s=>e.jsxs(n,{className:"flex items-center mb-3",children:[e.jsx(g,{variant:"rounded",width:40,height:40,className:"mr-3"}),e.jsxs(n,{className:"flex-1",children:[e.jsx(g,{width:"80%",height:20}),e.jsx(g,{width:"60%",height:16})]})]},s))}):e.jsx(M,{className:"max-h-44vh overflow-y-auto pr-1",children:d.sessions.map((s,m)=>e.jsxs(R.Fragment,{children:[e.jsxs(P,{className:"px-0 text-inherit",component:C,to:`/libraries/${s.game_id}`,children:[e.jsx(z,{children:e.jsx(H,{variant:"rounded",src:s.imageUrl})}),e.jsx(L,{primary:s.gameTitle,secondary:i("home.lastPlayed",{time:k(s.end_time)})})]}),m!==d.sessions.length-1&&e.jsx(V,{})]},s.session_id))})]})})}),e.jsx(n,{className:"col-span-12 md:col-span-6 lg:col-span-3",children:e.jsx(N,{className:"h-full shadow-md",children:e.jsxs(A,{children:[e.jsxs(n,{className:"flex items-center mb-3",children:[e.jsx(he,{className:"mr-2 text-green-500"}),e.jsx(p,{variant:"h6",className:"font-bold",children:i("home.recentlyAdded","最近添加")})]}),d.loading?e.jsx(n,{className:"max-h-44vh overflow-y-auto pr-1",children:[1,2,3,4].map(s=>e.jsxs(n,{className:"flex items-center mb-3",children:[e.jsx(g,{variant:"rounded",width:40,height:40,className:"mr-3"}),e.jsxs(n,{className:"flex-1",children:[e.jsx(g,{width:"80%",height:20}),e.jsx(g,{width:"60%",height:16})]})]},s))}):e.jsx(M,{className:"max-h-44vh overflow-y-auto pr-1",children:d.added.map((s,m)=>e.jsxs(R.Fragment,{children:[e.jsxs(P,{className:"px-0 text-inherit",component:C,to:`/libraries/${s.id}`,children:[e.jsx(z,{children:e.jsx(H,{variant:"rounded",src:s.imageUrl})}),e.jsx(L,{primary:s.title,secondary:i("home.addedAt",{time:s.time?k(s.time):""})})]}),m!==d.added.length-1&&e.jsx(V,{})]},s.id))})]})})})]})]})};export{be as Home};
