const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-D1SIH30A.js","./index-CyaFj2Vu.css"])))=>i.map(i=>d[i]);
import{r as m,g as K,a as Q,u as X,ap as Ne,M as E,c as W,aq as we,j as e,b as Y,s as I,af as Me,m as D,z as Te,ar as Be,as as Pe,T as b,y as ae,e as ge,at as F,au as Ie,i as f,V as Le,B as g,D as v,av as S,aw as w,ax as Ae,f as M,X as B,ay as Ue,a2 as Re,az as re,$ as C,aA as k,aB as $,aC as ie,aD as V,ak as P,ai as ue,aE as Ee,a4 as De,W as O,aF as $e,aG as Fe,aH as ne,a8 as ce,ad as h,aI as oe,aJ as J,aK as _e,aL as ze,aM as Ve,aN as Ge,_ as le}from"./index-D1SIH30A.js";import{B as We}from"./Backup-Cknob77E.js";import{R as Oe}from"./Restore-CTvIRDOR.js";import{u as He}from"./useScrollRestore-OqMkFYbK.js";const me=m.createContext({});function qe(s){return K("MuiAccordion",s)}const q=Q("MuiAccordion",["root","heading","rounded","expanded","disabled","gutters","region"]),Je=s=>{const{classes:t,square:a,expanded:n,disabled:r,disableGutters:i}=s;return Y({root:["root",!a&&"rounded",n&&"expanded",r&&"disabled",!i&&"gutters"],heading:["heading"],region:["region"]},qe,t)},Ke=I(Me,{name:"MuiAccordion",slot:"Root",overridesResolver:(s,t)=>{const{ownerState:a}=s;return[{[`& .${q.region}`]:t.region},t.root,!a.square&&t.rounded,!a.disableGutters&&t.gutters]}})(D(({theme:s})=>{const t={duration:s.transitions.duration.shortest};return{position:"relative",transition:s.transitions.create(["margin"],t),overflowAnchor:"none","&::before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:(s.vars||s).palette.divider,transition:s.transitions.create(["opacity","background-color"],t)},"&:first-of-type":{"&::before":{display:"none"}},[`&.${q.expanded}`]:{"&::before":{opacity:0},"&:first-of-type":{marginTop:0},"&:last-of-type":{marginBottom:0},"& + &":{"&::before":{display:"none"}}},[`&.${q.disabled}`]:{backgroundColor:(s.vars||s).palette.action.disabledBackground}}}),D(({theme:s})=>({variants:[{props:t=>!t.square,style:{borderRadius:0,"&:first-of-type":{borderTopLeftRadius:(s.vars||s).shape.borderRadius,borderTopRightRadius:(s.vars||s).shape.borderRadius},"&:last-of-type":{borderBottomLeftRadius:(s.vars||s).shape.borderRadius,borderBottomRightRadius:(s.vars||s).shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}}},{props:t=>!t.disableGutters,style:{[`&.${q.expanded}`]:{margin:"16px 0"}}}]}))),Qe=I("h3",{name:"MuiAccordion",slot:"Heading"})({all:"unset"}),Xe=I("div",{name:"MuiAccordion",slot:"Region"})({}),Ye=m.forwardRef(function(t,a){const n=X({props:t,name:"MuiAccordion"}),{children:r,className:i,defaultExpanded:c=!1,disabled:l=!1,disableGutters:d=!1,expanded:x,onChange:y,slots:p={},slotProps:o={},TransitionComponent:u,TransitionProps:j,..._}=n,[T,L]=Ne({controlled:x,default:c,name:"Accordion",state:"expanded"}),A=m.useCallback(Ce=>{L(!T),y&&y(Ce,!T)},[T,y,L]),[U,...Z]=m.Children.toArray(r),ee=m.useMemo(()=>({expanded:T,disabled:l,disableGutters:d,toggle:A}),[T,l,d,A]),R={...n,disabled:l,disableGutters:d,expanded:T},G=Je(R),se={transition:u,...p},te={transition:j,...o},N={slots:se,slotProps:te},[H,be]=E("root",{elementType:Ke,externalForwardedProps:{...N,..._},className:W(G.root,i),shouldForwardComponentProp:!0,ownerState:R,ref:a}),[je,Se]=E("heading",{elementType:Qe,externalForwardedProps:N,className:G.heading,ownerState:R}),[fe,ye]=E("transition",{elementType:we,externalForwardedProps:N,ownerState:R}),[ve,ke]=E("region",{elementType:Xe,externalForwardedProps:N,ownerState:R,className:G.region,additionalProps:{"aria-labelledby":U.props.id,id:U.props["aria-controls"],role:"region"}});return e.jsxs(H,{...be,children:[e.jsx(je,{...Se,children:e.jsx(me.Provider,{value:ee,children:U})}),e.jsx(fe,{in:T,timeout:"auto",...ye,children:e.jsx(ve,{...ke,children:Z})})]})});function Ze(s){return K("MuiAccordionDetails",s)}Q("MuiAccordionDetails",["root"]);const es=s=>{const{classes:t}=s;return Y({root:["root"]},Ze,t)},ss=I("div",{name:"MuiAccordionDetails",slot:"Root"})(D(({theme:s})=>({padding:s.spacing(1,2,2)}))),ts=m.forwardRef(function(t,a){const n=X({props:t,name:"MuiAccordionDetails"}),{className:r,...i}=n,c=n,l=es(c);return e.jsx(ss,{className:W(l.root,r),ref:a,ownerState:c,...i})});function as(s){return K("MuiAccordionSummary",s)}const z=Q("MuiAccordionSummary",["root","expanded","focusVisible","disabled","gutters","contentGutters","content","expandIconWrapper"]),ns=s=>{const{classes:t,expanded:a,disabled:n,disableGutters:r}=s;return Y({root:["root",a&&"expanded",n&&"disabled",!r&&"gutters"],focusVisible:["focusVisible"],content:["content",a&&"expanded",!r&&"contentGutters"],expandIconWrapper:["expandIconWrapper",a&&"expanded"]},as,t)},os=I(Te,{name:"MuiAccordionSummary",slot:"Root"})(D(({theme:s})=>{const t={duration:s.transitions.duration.shortest};return{display:"flex",width:"100%",minHeight:48,padding:s.spacing(0,2),transition:s.transitions.create(["min-height","background-color"],t),[`&.${z.focusVisible}`]:{backgroundColor:(s.vars||s).palette.action.focus},[`&.${z.disabled}`]:{opacity:(s.vars||s).palette.action.disabledOpacity},[`&:hover:not(.${z.disabled})`]:{cursor:"pointer"},variants:[{props:a=>!a.disableGutters,style:{[`&.${z.expanded}`]:{minHeight:64}}}]}})),rs=I("span",{name:"MuiAccordionSummary",slot:"Content"})(D(({theme:s})=>({display:"flex",textAlign:"start",flexGrow:1,margin:"12px 0",variants:[{props:t=>!t.disableGutters,style:{transition:s.transitions.create(["margin"],{duration:s.transitions.duration.shortest}),[`&.${z.expanded}`]:{margin:"20px 0"}}}]}))),is=I("span",{name:"MuiAccordionSummary",slot:"ExpandIconWrapper"})(D(({theme:s})=>({display:"flex",color:(s.vars||s).palette.action.active,transform:"rotate(0deg)",transition:s.transitions.create("transform",{duration:s.transitions.duration.shortest}),[`&.${z.expanded}`]:{transform:"rotate(180deg)"}}))),cs=m.forwardRef(function(t,a){const n=X({props:t,name:"MuiAccordionSummary"}),{children:r,className:i,expandIcon:c,focusVisibleClassName:l,onClick:d,slots:x,slotProps:y,...p}=n,{disabled:o=!1,disableGutters:u,expanded:j,toggle:_}=m.useContext(me),T=N=>{_&&_(N),d&&d(N)},L={...n,expanded:j,disabled:o,disableGutters:u},A=ns(L),U={slots:x,slotProps:y},[Z,ee]=E("root",{ref:a,shouldForwardComponentProp:!0,className:W(A.root,i),elementType:os,externalForwardedProps:{...U,...p},ownerState:L,additionalProps:{focusRipple:!1,disableRipple:!0,disabled:o,"aria-expanded":j,focusVisibleClassName:W(A.focusVisible,l)},getSlotProps:N=>({...N,onClick:H=>{N.onClick?.(H),T(H)}})}),[R,G]=E("content",{className:A.content,elementType:rs,externalForwardedProps:U,ownerState:L}),[se,te]=E("expandIconWrapper",{className:A.expandIconWrapper,elementType:is,externalForwardedProps:U,ownerState:L});return e.jsxs(Z,{...ee,children:[e.jsx(R,{...G,children:r}),c&&e.jsx(se,{...te,children:c})]})});function ls(s){return K("MuiInputAdornment",s)}const de=Q("MuiInputAdornment",["root","filled","standard","outlined","positionStart","positionEnd","disablePointerEvents","hiddenLabel","sizeSmall"]);var pe;const ds=(s,t)=>{const{ownerState:a}=s;return[t.root,t[`position${ae(a.position)}`],a.disablePointerEvents===!0&&t.disablePointerEvents,t[a.variant]]},ps=s=>{const{classes:t,disablePointerEvents:a,hiddenLabel:n,position:r,size:i,variant:c}=s,l={root:["root",a&&"disablePointerEvents",r&&`position${ae(r)}`,c,n&&"hiddenLabel",i&&`size${ae(i)}`]};return Y(l,ls,t)},gs=I("div",{name:"MuiInputAdornment",slot:"Root",overridesResolver:ds})(D(({theme:s})=>({display:"flex",maxHeight:"2em",alignItems:"center",whiteSpace:"nowrap",color:(s.vars||s).palette.action.active,variants:[{props:{variant:"filled"},style:{[`&.${de.positionStart}&:not(.${de.hiddenLabel})`]:{marginTop:16}}},{props:{position:"start"},style:{marginRight:8}},{props:{position:"end"},style:{marginLeft:8}},{props:{disablePointerEvents:!0},style:{pointerEvents:"none"}}]}))),us=m.forwardRef(function(t,a){const n=X({props:t,name:"MuiInputAdornment"}),{children:r,className:i,component:c="div",disablePointerEvents:l=!1,disableTypography:d=!1,position:x,variant:y,...p}=n,o=Be()||{};let u=y;y&&o.variant,o&&!u&&(u=o.variant);const j={...n,hiddenLabel:o.hiddenLabel,size:o.size,disablePointerEvents:l,position:x,variant:u},_=ps(j);return e.jsx(Pe.Provider,{value:null,children:e.jsx(gs,{as:c,ownerState:j,className:W(_.root,i),ref:a,...p,children:typeof r=="string"&&!d?e.jsx(b,{color:"textSecondary",children:r}):e.jsxs(m.Fragment,{children:[x==="start"?pe||(pe=e.jsx("span",{className:"notranslate","aria-hidden":!0,children:"​"})):null,r]})})})}),ms=ge(e.jsx("path",{d:"m7 10 5 5 5-5z"})),hs=ge(e.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}));async function he(){return await F("plugin:autostart|is_enabled")}async function xs(){await F("plugin:autostart|enable")}async function bs(){await F("plugin:autostart|disable")}async function xe(){await F("plugin:process|restart")}const js=async()=>{try{await he()?bs():await xs()}catch(s){console.error("Error toggling autostart:",s)}};async function Ss(){try{const s=await F("backup_database");return console.log(`数据库已备份到: ${s.path}`),s}catch(s){throw console.error("备份数据库失败:",s),s}}async function fs(){const s=await Ie({filters:[{name:"SQLite Database",extensions:["db"]}],multiple:!1,directory:!1});return s?await F("import_database",{sourcePath:s}):null}const ys=()=>{const{t:s,i18n:t}=f(),a={"zh-CN":"简体中文(zh-CN)","zh-TW":"繁体中文(zh-TW)","en-US":"English(en-US)","ja-JP":"日本語(ja-JP)"},n=r=>{const i=r.target.value;t.changeLanguage(i)};return e.jsxs(g,{className:"min-w-30 mb-6",children:[e.jsx(S,{id:"language-select-label",className:"mb-2 font-semibold",children:s("pages.Settings.language")}),e.jsxs(re,{labelId:"language-select-label",id:"language-select",value:t.language,onChange:n,className:"w-60",renderValue:r=>a[r],children:[e.jsx(C,{value:"zh-CN",children:"简体中文(zh-CN)"}),e.jsx(C,{value:"zh-TW",children:"繁体中文(zh-TW)"}),e.jsx(C,{value:"en-US",children:"English(en-US)"}),e.jsx(C,{value:"ja-JP",children:"日本語(ja-JP)"})]})]})},vs=()=>{const{t:s}=f(),{bgmToken:t,setBgmToken:a}=M(),[n,r]=m.useState("");m.useEffect(()=>{r(t)},[t]);const i=()=>{oe("https://next.bgm.tv/demo/access-token/create")},c=()=>{try{a(n),h.success(s("pages.Settings.bgmTokenSettings.saveSuccess","BGM Token 保存成功"))}catch(d){console.error(d),h.error(s("pages.Settings.bgmTokenSettings.saveError","BGM Token 保存失败"))}},l=()=>{r("")};return e.jsxs(g,{className:"mb-8",children:[e.jsx(S,{className:"font-semibold mb-4",children:s("pages.Settings.bgmToken")}),e.jsxs(B,{direction:"row",spacing:2,alignItems:"center",flexWrap:"wrap",children:[e.jsx(Ue,{autoComplete:"off",placeholder:s("pages.Settings.tokenPlaceholder"),value:n,onChange:d=>r(d.target.value),variant:"outlined",size:"medium",className:"min-w-60",slotProps:{htmlInput:{style:{WebkitTextSecurity:"disc",textSecurity:"disc"}},input:{endAdornment:n&&e.jsx(us,{position:"end",children:e.jsx(Re,{onClick:l,edge:"end",size:"small","aria-label":s("pages.Settings.bgmTokenSettings.clearToken","清除令牌"),children:e.jsx(hs,{})})})}}}),e.jsx(w,{variant:"contained",color:"primary",onClick:c,className:"px-6 py-2",children:s("pages.Settings.saveBtn")}),e.jsx(w,{variant:"outlined",color:"primary",onClick:i,className:"px-6 py-2",children:s("pages.Settings.getToken")})]})]})},ks=()=>{const{t:s}=f(),[t,a]=m.useState(!1);return m.useEffect(()=>{(async()=>a(await he()))()},[]),e.jsx(g,{className:"mb-6",children:e.jsxs(B,{direction:"row",alignItems:"center",className:"min-w-60",children:[e.jsx(g,{children:e.jsx(S,{className:"font-semibold mb-1",children:s("pages.Settings.autoStart")})}),e.jsx($,{checked:t,onChange:()=>{a(!t),js()},color:"primary"})]})})},Cs=()=>{const{t:s}=f(),{nsfwFilter:t,setNsfwFilter:a,nsfwCoverReplace:n,setNsfwCoverReplace:r}=M();return e.jsxs(g,{className:"mb-6",children:[e.jsx(S,{className:"font-semibold mb-4",children:s("pages.Settings.nsfw.title")}),e.jsxs(g,{className:"pl-2",children:[e.jsx(k,{control:e.jsx($,{checked:t,onChange:i=>a(i.target.checked),color:"primary"}),label:s("pages.Settings.nsfw.filter")}),e.jsx(k,{control:e.jsx($,{checked:n,onChange:i=>r(i.target.checked),color:"primary"}),label:s("pages.Settings.nsfw.coverReplace")})]})]})},Ns=()=>{const{t:s}=f(),{logLevel:t,setLogLevel:a}=M();m.useEffect(()=>{const i=async()=>{try{const c=await J.getLogLevel();a(c)}catch(c){console.error("获取日志级别失败:",c)}};P()&&i()},[a]);const n=async i=>{const c=i.target.value;a(c);try{await J.setLogLevel(c),h.success(s("pages.Settings.logLevel.changed",`日志级别已切换为 ${c}`,{level:c}))}catch{h.error(s("pages.Settings.logLevel.changeFailed","切换日志级别失败"))}},r=async()=>{try{const i=await _e(),c=ze(i,"logs");await F("open_directory",{dirPath:c})}catch(i){const c=i instanceof Error?i.message:s("pages.Settings.logLevel.openFolderFailed","打开文件夹失败");h.error(s("pages.Settings.logLevel.openFolderError",{error:c}))}};return e.jsxs(g,{className:"mb-6",children:[e.jsx(S,{className:"font-semibold mb-4",children:s("pages.Settings.logLevel.title","日志设置")}),e.jsxs(g,{className:"pl-2 space-y-4",children:[e.jsxs(g,{children:[e.jsx(S,{className:"mb-2 text-sm",children:s("pages.Settings.logLevel.levelLabel","日志输出级别")}),e.jsx(b,{variant:"caption",color:"text.secondary",className:"block mb-2",children:s("pages.Settings.logLevel.description","仅当前会话有效，不会保存。用于临时调整后端日志输出详尽程度。")}),e.jsxs(re,{value:t,onChange:n,className:"min-w-40",size:"small",children:[e.jsx(C,{value:"error",children:"Error"}),e.jsx(C,{value:"warn",children:"Warn"}),e.jsx(C,{value:"info",children:"Info"}),e.jsx(C,{value:"debug",children:"Debug"})]})]}),e.jsx(g,{children:e.jsx(w,{variant:"outlined",color:"primary",onClick:r,startIcon:e.jsx(ue,{}),className:"px-6 py-2",disabled:!P(),children:s("pages.Settings.logLevel.openFolder","打开日志文件夹")})})]})]})},ws=()=>{const{t:s}=f();return e.jsxs(g,{className:"mb-6",children:[e.jsx(S,{className:"font-semibold mb-4",children:s("pages.Settings.vndbData.title","VNDB 数据设置")}),e.jsxs(g,{className:"pl-2 space-y-4",children:[e.jsx(Ms,{}),e.jsx(v,{sx:{my:2}}),e.jsx(Ts,{})]})]})},Ms=()=>{const{t:s}=f(),{tagTranslation:t,setTagTranslation:a}=M();return e.jsx(g,{className:"mb-6",children:e.jsxs(B,{direction:"row",alignItems:"center",className:"min-w-60",children:[e.jsxs(g,{children:[e.jsx(S,{className:"font-semibold mb-1",children:s("pages.Settings.tagTranslation.title")}),e.jsx(b,{variant:"caption",color:"text.secondary",children:s("pages.Settings.tagTranslation.description")})]}),e.jsx($,{checked:t,onChange:n=>a(n.target.checked),color:"primary"})]})})},Ts=()=>{const{t:s}=f(),{spoilerLevel:t,setSpoilerLevel:a}=M();return e.jsx(g,{className:"mb-6",children:e.jsxs(B,{direction:"row",alignItems:"center",spacing:1,children:[e.jsxs(g,{children:[e.jsx(S,{className:"font-semibold mb-1",children:s("pages.Settings.spoilerLevel.title")}),e.jsx(b,{variant:"caption",color:"text.secondary",children:s("pages.Settings.spoilerLevel.description")})]}),e.jsxs(re,{value:t,onChange:n=>a(n.target.value),className:"min-w-40",size:"small",children:[e.jsx(C,{value:0,children:s("pages.Settings.spoilerLevel.level0")}),e.jsx(C,{value:1,children:s("pages.Settings.spoilerLevel.level1")}),e.jsx(C,{value:2,children:s("pages.Settings.spoilerLevel.level2")})]})]})})},Bs=()=>{const{t:s}=f(),{cardClickMode:t,setCardClickMode:a,doubleClickLaunch:n,setDoubleClickLaunch:r,longPressLaunch:i,setLongPressLaunch:c}=M();return e.jsxs(g,{className:"mb-6",children:[e.jsx(S,{className:"font-semibold mb-4",children:s("pages.Settings.cardClickMode.title")}),e.jsxs(g,{className:"pl-2",children:[e.jsxs(ie,{value:t,onChange:l=>a(l.target.value),className:"pl-2",children:[e.jsx(k,{value:"navigate",control:e.jsx(V,{color:"primary"}),label:s("pages.Settings.cardClickMode.navigate"),className:"mb-1"}),e.jsx(k,{value:"select",control:e.jsx(V,{color:"primary"}),label:s("pages.Settings.cardClickMode.select"),className:"mb-1"})]}),e.jsxs(g,{className:"mt-4 pl-2",children:[e.jsx(k,{control:e.jsx($,{checked:n,onChange:l=>r(l.target.checked),color:"primary"}),label:s("pages.Settings.cardClickMode.doubleClickLaunch"),className:"mb-1"}),n&&t==="navigate"&&e.jsx(b,{variant:"caption",color:"text.secondary",className:"block ml-8",children:s("pages.Settings.cardClickMode.doubleClickLaunchNote")})]}),e.jsxs(g,{className:"mt-4 pl-2",children:[e.jsx(k,{control:e.jsx($,{checked:i,onChange:l=>c(l.target.checked),color:"primary"}),label:s("pages.Settings.cardClickMode.longPressLaunch"),className:"mb-1"}),i&&e.jsx(b,{variant:"caption",color:"text.secondary",className:"block ml-8",children:s("pages.Settings.cardClickMode.longPressLaunchNote")})]})]})]})},Ps=()=>{const{t:s}=f(),{skipCloseRemind:t,defaultCloseAction:a,setSkipCloseRemind:n,setDefaultCloseAction:r}=M();return e.jsxs(g,{className:"mb-6",children:[e.jsx(S,{className:"font-semibold mb-4",children:s("pages.Settings.closeSettings")}),e.jsxs(g,{className:"pl-2",children:[e.jsx(k,{control:e.jsx(Ee,{checked:t,onChange:i=>n(i.target.checked),color:"primary"}),label:s("pages.Settings.skipCloseRemind"),className:"mb-2"}),e.jsxs(ie,{value:a,onChange:i=>r(i.target.value),className:"pl-4",children:[e.jsx(k,{value:"hide",control:e.jsx(V,{color:"primary"}),label:s("pages.Settings.closeToTray"),disabled:!t,className:t?"":"opacity-50 transition-opacity duration-200"}),e.jsx(k,{value:"close",control:e.jsx(V,{color:"primary"}),label:s("pages.Settings.closeApp"),disabled:!t,className:t?"":"opacity-50 transition-opacity duration-200"})]})]})]})},Is=()=>{const{t:s}=f(),[t,a]=m.useState(!1),[n,r]=m.useState(!1),i=async()=>{a(!0);try{const d=await Ss();d.success?h.success(s("pages.Settings.databaseBackup.backupSuccess",{path:d.path})):h.error(s("pages.Settings.databaseBackup.backupError",{error:d.message}))}catch(d){const x=d instanceof Error?d.message:s("pages.Settings.databaseBackup.backupFailed","备份失败");h.error(s("pages.Settings.databaseBackup.backupError",{error:x}))}finally{a(!1)}},c=async()=>{try{await Ve()}catch(d){const x=d instanceof Error?d.message:s("pages.Settings.databaseBackup.openFolderFailed","打开文件夹失败");h.error(s("pages.Settings.databaseBackup.openFolderError",{error:x}))}},l=async()=>{r(!0);try{const d=await fs();d&&(d.success?(h.success(s("pages.Settings.databaseBackup.importSuccess","数据库导入成功，应用将自动重启")),setTimeout(async()=>{await xe()},2e3)):h.error(s("pages.Settings.databaseBackup.importError",{error:d.message})))}catch(d){const x=d instanceof Error?d.message:s("pages.Settings.databaseBackup.importFailed","导入失败");h.error(s("pages.Settings.databaseBackup.importError",{error:x}))}finally{r(!1)}};return e.jsxs(g,{className:"mb-6",children:[e.jsx(S,{className:"font-semibold mb-4",children:s("pages.Settings.databaseBackup.title","数据库备份与恢复")}),e.jsxs(B,{direction:"row",spacing:2,alignItems:"center",flexWrap:"wrap",children:[e.jsx(w,{variant:"contained",color:"primary",onClick:i,disabled:t||!P(),startIcon:t?e.jsx(O,{size:16,color:"inherit"}):e.jsx(We,{}),className:"px-6 py-2",children:t?s("pages.Settings.databaseBackup.backing","备份中..."):s("pages.Settings.databaseBackup.backup","备份数据库")}),e.jsx(w,{variant:"outlined",color:"primary",onClick:c,startIcon:e.jsx(ue,{}),className:"px-6 py-2",disabled:!P(),children:s("pages.Settings.databaseBackup.openFolder","打开备份文件夹")}),e.jsx(w,{variant:"outlined",color:"warning",onClick:l,disabled:n||!P(),startIcon:n?e.jsx(O,{size:16,color:"inherit"}):e.jsx(Oe,{}),className:"px-6 py-2",children:n?s("pages.Settings.databaseBackup.importing","导入中..."):s("pages.Settings.databaseBackup.restore","恢复数据库")})]}),e.jsx(b,{variant:"caption",color:"text.secondary",className:"block mt-2",children:s("pages.Settings.databaseBackup.restoreWarning","恢复数据库将覆盖现有数据，请谨慎操作。导入后应用将自动重启。")}),e.jsx(b,{variant:"caption",color:"text.secondary",className:"block mt-1",children:s("pages.Settings.databaseBackup.pathNote","备份路径配置已移至下方的「数据库备份路径」设置中")})]})},Ls=()=>{const{t:s}=f(),[t,a]=m.useState(!1),[n,r]=m.useState(!1),[i,c]=m.useState(!1),[l,d]=m.useState(!1);m.useEffect(()=>{(async()=>{r(!0);try{const o=await J.getPortableMode();a(o)}catch(o){console.error("加载便携模式状态失败:",o)}finally{r(!1)}})()},[]);const x=async p=>{const o=p.target.checked;d(o),c(!0)},y=async()=>{c(!1),r(!0);try{const p=await J.setPortableMode(l);if(a(l),p.total_files>0){const o=[];p.database_migrated&&o.push("数据库文件"),p.database_backups_count>0&&o.push(`${p.database_backups_count} 个数据库备份`),p.savedata_backups_count>0&&o.push(`${p.savedata_backups_count} 个存档备份`),h.success(`${p.message}（${o.join("、")}）`)}else h.success(p.message);p.requires_restart&&setTimeout(async()=>{try{await xe()}catch(o){console.error("重启应用失败:",o),h.error(s("pages.Settings.restartError","重启失败，请手动重启应用"))}},1500)}catch(p){console.error("切换便携模式失败:",p);const o=p instanceof Error?p.message:String(p);h.error(o||s("pages.Settings.portableMode.toggleError","切换失败"))}finally{r(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs(g,{className:"mb-6",children:[e.jsx(S,{className:"font-semibold mb-4",children:s("pages.Settings.portableMode.title","便携模式")}),e.jsx(B,{direction:"row",alignItems:"center",className:"mb-2",children:e.jsx(k,{control:e.jsx($,{checked:t,onChange:x,disabled:n||!P(),color:"primary"}),label:s("pages.Settings.portableMode.enable","启用便携模式")})}),e.jsx(b,{variant:"caption",color:"text.secondary",className:"block mt-1",children:s("pages.Settings.portableMode.description","开启便携模式后，数据库和备份将保存在程序安装目录resources文件夹下，而非系统应用数据目录。适合需要将程序放在U盘或移动硬盘中使用的场景。")})]}),e.jsx(De,{open:i,setOpen:c,title:s("pages.Settings.portableMode.confirmTitle","确认切换便携模式"),message:l?s("pages.Settings.portableMode.confirmEnableMessage","启用便携模式后，数据库和备份将迁移至程序安装目录。操作成功后应用将自动重启。"):s("pages.Settings.portableMode.confirmDisableMessage","关闭便携模式后，数据库和备份将迁移至系统应用数据目录。操作成功后应用将自动重启。"),onConfirm:y,confirmText:s("common.confirm","确认"),confirmColor:"warning"})]})},As=()=>{const{t:s}=f(),{timeTrackingMode:t,setTimeTrackingMode:a}=M();return e.jsxs(g,{className:"mb-6",children:[e.jsx(S,{className:"font-semibold mb-4",children:s("pages.Settings.timeTrackingMode.title","游戏计时模式")}),e.jsxs(g,{className:"pl-2",children:[e.jsx(b,{variant:"caption",color:"text.secondary",className:"block mb-3",children:s("pages.Settings.timeTrackingMode.description","选择游戏时间的计算方式，影响游戏运行时的时间显示和统计记录。")}),e.jsxs(ie,{value:t,onChange:n=>a(n.target.value),className:"pl-2",children:[e.jsx(k,{value:"playtime",control:e.jsx(V,{color:"primary"}),label:e.jsxs(g,{children:[e.jsx(b,{variant:"body2",children:s("pages.Settings.timeTrackingMode.playtime","真实游戏时间（默认）")}),e.jsx(b,{variant:"caption",color:"text.secondary",children:s("pages.Settings.timeTrackingMode.playtimeDesc","仅计算游戏窗口在前台时的时间，切换到其他窗口时暂停计时")})]}),className:"mb-2"}),e.jsx(k,{value:"elapsed",control:e.jsx(V,{color:"primary"}),label:e.jsxs(g,{children:[e.jsx(b,{variant:"body2",children:s("pages.Settings.timeTrackingMode.elapsed","游戏启动时间")}),e.jsx(b,{variant:"caption",color:"text.secondary",children:s("pages.Settings.timeTrackingMode.elapsedDesc","计算从游戏启动到结束的总时间，不区分前台后台")})]}),className:"mb-1"})]})]})]})},Us=()=>{const{t:s}=f(),{triggerUpdateModal:t}=M(),[a,n]=m.useState(!1),[r,i]=m.useState(""),c=async()=>{n(!0),i("");try{await Ge({onUpdateFound:x=>{i(`发现新版本: ${x.version}`),t(x)},onNoUpdate:()=>{i("当前已是最新版本")},onError:x=>{i(`检查更新失败: ${x}`)}})}catch(x){i(`检查更新出错: ${x}`)}finally{n(!1)}},l=()=>{oe("https://github.com/huoshen80/ReinaManager")},d=()=>{oe("https://huoshen80.top")};return e.jsxs(g,{className:"mb-6",children:[e.jsx(S,{className:"font-semibold mb-4",children:s("pages.Settings.about.title","关于")}),e.jsxs(g,{className:"pl-2 space-y-3",children:[e.jsxs(B,{direction:"row",alignItems:"center",spacing:2,children:[e.jsxs(b,{variant:"body2",children:[e.jsxs("strong",{children:[s("pages.Settings.about.version","版本"),": "]}),"v",Fe.version]}),e.jsx(w,{variant:"outlined",startIcon:a?e.jsx(O,{size:16,color:"inherit"}):e.jsx(ne,{}),onClick:c,disabled:a,size:"small",children:a?s("pages.Settings.about.checking","检查中..."):s("pages.Settings.about.checkUpdate","检查更新")})]}),r&&e.jsx(b,{variant:"body2",color:r.includes("失败")||r.includes("出错")?"error":"primary",children:r}),e.jsxs(b,{variant:"body2",children:[e.jsxs("strong",{children:[s("pages.Settings.about.author","作者"),": "]}),"huoshen80"]}),e.jsxs(b,{variant:"body2",children:[e.jsxs("strong",{children:[s("pages.Settings.about.github","项目地址"),": "]}),e.jsx(ce,{component:"button",variant:"body2",onClick:l,sx:{textDecoration:"none"},children:"https://github.com/huoshen80/ReinaManager"})]}),e.jsxs(b,{variant:"body2",children:[e.jsxs("strong",{children:[s("pages.Settings.about.blog","作者博客"),": "]}),e.jsx(ce,{component:"button",variant:"body2",onClick:d,sx:{textDecoration:"none"},children:"https://huoshen80.top"})]})]})]})},Rs=()=>{const{t:s}=f();return e.jsxs(Ye,{children:[e.jsx(cs,{expandIcon:e.jsx(ms,{}),"aria-controls":"panel2-content",id:"panel2-header",children:e.jsx($e,{title:s("pages.Settings.dev.tooltip","以下功能为实验性功能，请谨慎使用"),children:e.jsx(b,{component:"span",children:s("pages.Settings.dev.title","实验性功能")})})}),e.jsx(ts,{children:e.jsx(Es,{})})]})},Es=()=>{const{t:s}=f(),{bgmToken:t}=M(),[a,n]=m.useState(!1),[r,i]=m.useState(!1),[c,l]=m.useState(""),d=async()=>{n(!0),l("");try{const{batchUpdateVndbData:p}=await le(async()=>{const{batchUpdateVndbData:u}=await import("./index-D1SIH30A.js").then(j=>j.bI);return{batchUpdateVndbData:u}},__vite__mapDeps([0,1]),import.meta.url);h.info(s("pages.Settings.batchUpdate.updating","正在批量更新 VNDB 数据..."));const o=await p();if(o.success>0){const u=s("pages.Settings.batchUpdate.success",`成功更新 ${o.success}/${o.total} 个游戏`,{success:o.success,total:o.total});l(u),h.success(u)}if(o.failed>0){const u=s("pages.Settings.batchUpdate.partialFailed",`${o.failed} 个游戏更新失败`,{failed:o.failed});l(j=>j?`${j}
${u}`:u),h.warning(u)}if(o.total===0){const u=s("pages.Settings.batchUpdate.noGames","没有找到包含 VNDB ID 的游戏");l(u),h.info(u)}}catch(p){const o=p instanceof Error?p.message:s("pages.Settings.batchUpdate.failed","批量更新失败");l(o),h.error(s("pages.Settings.batchUpdate.error",{message:o}))}finally{n(!1)}},x=async()=>{i(!0),l("");try{const{batchUpdateBgmData:p}=await le(async()=>{const{batchUpdateBgmData:u}=await import("./index-D1SIH30A.js").then(j=>j.bI);return{batchUpdateBgmData:u}},__vite__mapDeps([0,1]),import.meta.url);if(h.info(s("pages.Settings.batchUpdate.updatingBgm","正在批量更新 BGM 数据...")),t.trim()==="")throw new Error(s("pages.Settings.batchUpdate.noBgmToken","更新失败：未设置 BGM Token"));const o=await p(t);if(o.success>0){const u=s("pages.Settings.batchUpdate.success",`成功更新 ${o.success}/${o.total} 个游戏`,{success:o.success,total:o.total});l(u),h.success(u)}if(o.failed>0){const u=s("pages.Settings.batchUpdate.partialFailed",`${o.failed} 个游戏更新失败`,{failed:o.failed});l(j=>j?`${j}
${u}`:u),h.warning(u)}if(o.total===0){const u=s("pages.Settings.batchUpdate.noBgmGames","没有找到包含 BGM ID 的游戏");l(u),h.info(u)}}catch(p){const o=p instanceof Error?p.message:s("pages.Settings.batchUpdate.failed","批量更新失败");l(o),h.error(s("pages.Settings.batchUpdate.errorBgm",{message:o}))}finally{i(!1)}},y=a||r;return e.jsxs(g,{className:"mb-6",children:[e.jsx(S,{className:"font-semibold mb-4",children:s("pages.Settings.batchUpdate.title","批量更新数据")}),e.jsxs(B,{direction:"column",spacing:2,children:[e.jsx(b,{variant:"caption",className:"mb-2",children:s("pages.Settings.batchUpdate.description","批量更新功能可用于更新已存在游戏的 BGM/VNDB 数据。当游戏的元数据发生变化时，您可以使用此功能来同步最新的信息。一旦点击更新按钮请耐心等待，更新过程可能需要一些时间。推荐软件更新数据源获取字段时使用。")}),e.jsxs(B,{direction:"row",spacing:2,alignItems:"center",flexWrap:"wrap",children:[e.jsx(w,{variant:"contained",color:"info",onClick:x,disabled:y||!P(),startIcon:r?e.jsx(O,{size:16,color:"inherit"}):e.jsx(ne,{}),className:"px-6 py-2",children:r?s("pages.Settings.batchUpdate.updating","更新中..."):s("pages.Settings.batchUpdate.updateBgm","批量更新 BGM 数据")}),e.jsx(w,{variant:"contained",color:"primary",onClick:d,disabled:y||!P(),startIcon:a?e.jsx(O,{size:16,color:"inherit"}):e.jsx(ne,{}),className:"px-6 py-2",children:a?s("pages.Settings.batchUpdate.updating","更新中..."):s("pages.Settings.batchUpdate.updateVndb","批量更新 VNDB 数据")})]}),c&&e.jsx(b,{variant:"body2",color:c.includes("失败")||c.includes("fail")||c.includes("错误")||c.includes("error")?"error":"primary",className:"whitespace-pre-line",children:c})]})]})},zs=()=>{const{t:s}=f();He("/settings");const[t,a]=m.useState(!1);return e.jsxs(Le,{className:"max-w-full",children:[e.jsxs(g,{className:"py-4",children:[e.jsx(vs,{}),e.jsx(v,{sx:{my:3}}),e.jsx(ys,{}),e.jsx(v,{sx:{my:3}}),e.jsx(ws,{}),e.jsx(v,{sx:{my:3}}),e.jsx(Cs,{}),e.jsx(v,{sx:{my:3}}),e.jsx(Bs,{}),e.jsx(v,{sx:{my:3}}),e.jsx(ks,{}),e.jsx(v,{sx:{my:3}}),e.jsx(Ns,{}),e.jsx(v,{sx:{my:3}}),e.jsx(Ps,{}),e.jsx(v,{sx:{my:3}}),e.jsx(Ls,{}),e.jsx(v,{sx:{my:3}}),e.jsxs(g,{className:"mb-6",children:[e.jsx(S,{className:"font-semibold mb-4",children:s("pages.Settings.pathSettings.title","路径设置")}),e.jsx(w,{variant:"outlined",onClick:()=>a(!0),className:"px-4 py-2",children:s("pages.Settings.pathSettings.openModal","打开路径设置")}),e.jsx(b,{variant:"caption",color:"text.secondary",className:"block mt-2",children:s("pages.Settings.pathSettings.note","配置游戏存档备份、LE转区软件、Magpie软件、数据库备份等路径")})]}),e.jsx(v,{sx:{my:3}}),e.jsx(Is,{}),e.jsx(v,{sx:{my:3}}),e.jsx(As,{}),e.jsx(v,{sx:{my:3}}),e.jsx(Rs,{}),e.jsx("br",{}),e.jsx(Us,{})]}),e.jsx(Ae,{open:t,onClose:()=>a(!1),inSettingsPage:!0})]})};export{zs as Settings};
